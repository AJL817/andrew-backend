<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Andrew Investment System</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.1/chart.umd.min.js"></script>
<style>
* { margin:0; padding:0; box-sizing:border-box; }
:root {
  --bg:#0a0b0f; --surface:#12131a; --surface2:#1a1b24; --surface3:#222436;
  --border:#1e2030; --text:#e8e9f0; --dim:#6b7094; --muted:#4a4d6a;
  --accent:#c9a55a; --accent-dim:rgba(201,165,90,0.15);
  --green:#22c55e; --green-dim:rgba(34,197,94,0.12);
  --red:#ef4444; --red-dim:rgba(239,68,68,0.12);
  --blue:#3b82f6; --blue-dim:rgba(59,130,246,0.12);
  --orange:#f59e0b; --orange-dim:rgba(245,158,11,0.12);
  --purple:#8b5cf6; --purple-dim:rgba(139,92,246,0.12);
}
body { background:var(--bg); color:var(--text); font-family:'Pretendard',-apple-system,sans-serif; display:flex; min-height:100vh; font-size:14px; }

/* ì‚¬ì´ë“œë°” */
#sidebar { width:220px; min-height:100vh; background:var(--surface); border-right:1px solid var(--border); padding:20px 12px; display:flex; flex-direction:column; position:fixed; top:0; left:0; z-index:100; }
.logo h1 { font-size:22px; font-weight:800; color:var(--accent); letter-spacing:-0.5px; }
.logo p { font-size:8px; color:var(--muted); letter-spacing:3px; margin-top:2px; }
.status { display:flex; align-items:center; gap:6px; margin-top:8px; }
.dot { width:6px; height:6px; border-radius:50%; background:var(--orange); transition:all 0.3s; }
.dot.on { background:var(--green); box-shadow:0 0 8px rgba(34,197,94,0.5); }
.dot.off { background:var(--red); }
nav { display:flex; flex-direction:column; gap:3px; flex:1; margin-top:24px; }
.nb { display:flex; align-items:center; gap:10px; padding:10px 12px; border-radius:8px; border:none; cursor:pointer; font-size:13px; font-family:inherit; text-align:left; background:transparent; color:var(--dim); transition:all 0.15s; width:100%; }
.nb.active,.nb:hover { background:var(--accent-dim); color:var(--accent); font-weight:600; }
.ni { font-size:14px; width:20px; text-align:center; }
.sf { padding:12px 8px; border-top:1px solid var(--border); margin-top:auto; font-size:10px; color:var(--muted); line-height:1.6; }

/* ë©”ì¸ */
#main { flex:1; margin-left:220px; display:flex; flex-direction:column; min-height:100vh; }
#topbar { height:52px; border-bottom:1px solid var(--border); display:flex; align-items:center; justify-content:space-between; padding:0 24px; position:sticky; top:0; background:var(--bg); z-index:50; }
#content { flex:1; padding:24px; }

/* íƒ­ */
.tp { display:none; flex-direction:column; gap:20px; }
.tp.active { display:flex; }

/* ì¹´ë“œ */
.card { background:var(--surface); border:1px solid var(--border); border-radius:12px; padding:18px; }
.card-sm { background:var(--surface); border:1px solid var(--border); border-radius:10px; padding:14px 16px; }
.ct { font-size:11px; color:var(--muted); margin-bottom:10px; text-transform:uppercase; letter-spacing:0.5px; }

/* ë°°ì§€ */
.badge { display:inline-flex; align-items:center; padding:3px 9px; border-radius:5px; font-size:10px; font-weight:700; letter-spacing:0.5px; }
.bh { color:var(--red); background:var(--red-dim); }
.bm { color:var(--orange); background:var(--orange-dim); }
.bn { color:var(--muted); background:var(--surface2); }
.bb { color:var(--blue); background:var(--blue-dim); }
.ba { color:var(--accent); background:var(--accent-dim); }
.bg { color:var(--green); background:var(--green-dim); }
.bp { color:var(--purple); background:var(--purple-dim); }

/* ë²„íŠ¼ */
.btn { padding:7px 14px; border-radius:8px; border:none; cursor:pointer; font-size:12px; font-weight:600; font-family:inherit; background:var(--surface2); color:var(--dim); transition:all 0.15s; }
.btn:hover { background:var(--accent-dim); color:var(--accent); }
.btn-accent { background:var(--accent); color:var(--bg); }
.btn-accent:hover { background:#d4b06a; }
select { background:var(--surface); border:1px solid var(--border); color:var(--text); border-radius:8px; padding:7px 12px; font-size:12px; font-family:inherit; cursor:pointer; outline:none; }

/* í•„í„° */
.filter-btn { padding:5px 14px; border-radius:20px; border:1px solid var(--border); cursor:pointer; font-size:12px; font-weight:600; font-family:inherit; background:var(--surface); color:var(--dim); transition:all 0.15s; }
.filter-btn.active { background:var(--accent-dim); color:var(--accent); border-color:var(--accent); }

/* ê³µì‹œ */
.di { background:var(--surface); border:1px solid var(--border); border-radius:8px; padding:13px 16px; display:flex; align-items:center; gap:10px; cursor:pointer; text-decoration:none; transition:all 0.15s; }
.di:hover { border-color:var(--accent); transform:translateX(2px); }

/* ìŠ¤ì½”ì–´ë°” */
.sb-wrap { display:flex; align-items:center; gap:8px; }
.sb-track { flex:1; height:5px; background:var(--border); border-radius:3px; overflow:hidden; }
.sb-fill { height:100%; border-radius:3px; transition:width 0.6s ease; }
.sb-num { font-size:12px; font-weight:700; min-width:28px; text-align:right; }

/* ì¢…ëª© ì¹´ë“œ */
.stock-card { background:var(--surface); border:1px solid var(--border); border-radius:12px; padding:18px; cursor:pointer; transition:all 0.2s; }
.stock-card:hover, .stock-card.selected { border-color:var(--accent); background:var(--surface2); }
.stock-grid { display:grid; grid-template-columns:repeat(3,1fr); gap:12px; }

/* ì² í•™ ë§¤ì¹­ */
.match-bar { height:8px; background:var(--border); border-radius:4px; overflow:hidden; margin:6px 0; }
.match-fill { height:100%; border-radius:4px; background:linear-gradient(90deg,var(--green),var(--accent)); transition:width 0.8s ease; }
.checklist { display:flex; flex-direction:column; gap:6px; }
.check-item { display:flex; align-items:center; gap:8px; padding:8px 10px; border-radius:8px; }
.check-item.pass { background:var(--green-dim); }
.check-item.fail { background:var(--red-dim); }
.check-item.warn { background:var(--orange-dim); }

/* ë§¤ìˆ˜ ë¹„ì¤‘ ê²Œì´ì§€ */
.position-ring { position:relative; display:inline-flex; align-items:center; justify-content:center; }

/* ì„±ê³µí™•ë¥  */
.prob-bar { height:12px; background:var(--border); border-radius:6px; overflow:hidden; margin-top:6px; }
.prob-fill { height:100%; border-radius:6px; }

/* ì°¨íŠ¸ ì»¨í…Œì´ë„ˆ */
.chart-wrap { position:relative; }

/* ìŠ¤í”¼ë„ˆ */
.spin-wrap { display:flex; align-items:center; gap:8px; color:var(--muted); font-size:13px; padding:30px 20px; }
.spin { width:16px; height:16px; border:2px solid var(--border); border-top:2px solid var(--accent); border-radius:50%; animation:spin 0.8s linear infinite; }
@keyframes spin { to { transform:rotate(360deg); } }

/* ì—ëŸ¬ */
.err { background:var(--red-dim); border:1px solid rgba(239,68,68,0.3); border-radius:10px; padding:14px; }

/* AI ì±„íŒ… */
#chat-wrap { display:flex; flex-direction:column; height:calc(100vh - 200px); }
#chat-msgs { flex:1; overflow-y:auto; display:flex; flex-direction:column; gap:10px; padding:4px; margin-bottom:14px; }
.msg { padding:12px 16px; border-radius:14px; font-size:13px; line-height:1.7; white-space:pre-wrap; max-width:85%; }
.msg-u { align-self:flex-end; background:var(--accent); color:var(--bg); border-radius:14px 14px 4px 14px; font-weight:500; }
.msg-a { align-self:flex-start; background:var(--surface2); border:1px solid var(--border); border-radius:14px 14px 14px 4px; }
.msg-s { background:var(--surface2); font-size:11px; color:var(--dim); max-width:100%; border-radius:8px; }
.ci { display:flex; gap:8px; padding:12px 16px; background:var(--surface); border-radius:12px; border:1px solid var(--border); }
.ci input { flex:1; background:transparent; border:none; outline:none; color:var(--text); font-size:13px; font-family:inherit; }

/* ê·¸ë¦¬ë“œ */
.g2 { display:grid; grid-template-columns:1fr 1fr; gap:16px; }
.g3 { display:grid; grid-template-columns:repeat(3,1fr); gap:12px; }
.g4 { display:grid; grid-template-columns:repeat(4,1fr); gap:12px; }

/* íˆ¬ì ì¼ì§€ */
.journal-card { background:var(--surface); border:1px solid var(--border); border-radius:12px; padding:20px; }
.journal-card:hover { border-color:var(--border); }

/* ìƒì„¸ íŒ¨ë„ */
#detail-panel { display:none; }
#detail-panel.open { display:block; }

/* ë°˜ì‘í˜• í…Œì´ë¸” */
.tbl-wrap { overflow-x:auto; border-radius:12px; border:1px solid var(--border); }
table { width:100%; border-collapse:collapse; }
th { padding:11px 14px; font-size:10px; font-weight:600; color:var(--muted); text-align:left; letter-spacing:0.5px; border-bottom:1px solid var(--border); background:var(--surface); white-space:nowrap; }
td { padding:11px 14px; border-bottom:1px solid var(--border); font-size:13px; background:var(--surface); }
tr:last-child td { border-bottom:none; }
tr:hover td { background:var(--surface2); }

/* ìˆ«ì ê°•ì¡° */
.num-up { color:var(--green); font-weight:600; }
.num-dn { color:var(--red); font-weight:600; }
.num-neutral { color:var(--orange); font-weight:600; }

/* í—¤ë” ì„¹ì…˜ */
.section-header { display:flex; align-items:center; justify-content:space-between; margin-bottom:4px; }
.section-title { font-size:17px; font-weight:700; }
.section-sub { font-size:11px; color:var(--muted); margin-top:3px; }
</style>
</head>
<body>

<!-- ì‚¬ì´ë“œë°” -->
<div id="sidebar">
  <div class="logo">
    <h1>ANDREW</h1>
    <p>INVESTMENT SYSTEM v2</p>
    <div class="status">
      <div class="dot" id="dot"></div>
      <span style="font-size:10px;color:var(--muted);" id="stxt">í™•ì¸ì¤‘...</span>
    </div>
  </div>
  <nav>
    <button class="nb active" onclick="go('dash')" id="nav-dash"><span class="ni">â—‰</span>ëŒ€ì‹œë³´ë“œ</button>
    <button class="nb" onclick="go('kr')" id="nav-kr"><span class="ni">ğŸ‡°ğŸ‡·</span>êµ­ì¥ ë¶„ì„</button>
    <button class="nb" onclick="go('us')" id="nav-us"><span class="ni">ğŸ‡ºğŸ‡¸</span>ë¯¸ì¥ ë¶„ì„</button>
    <button class="nb" onclick="go('bonds')" id="nav-bonds"><span class="ni">â—†</span>ì±„ê¶ŒÂ·ì›ìì¬</button>
    <button class="nb" onclick="go('journal')" id="nav-journal"><span class="ni">âœ</span>íˆ¬ì ì¼ì§€</button>
    <button class="nb" onclick="go('ai')" id="nav-ai"><span class="ni">â¬¡</span>AI ë¶„ì„</button>
  </nav>
  <div class="sf">
    Draft 3.0 íˆ¬ì ì² í•™<br>
    DART ì‹¤ì‹œê°„ Â· KIS Â· AlphaVantage
  </div>
</div>

<!-- ë©”ì¸ -->
<div id="main">
  <div id="topbar">
    <span id="dateStr" style="font-size:12px;color:var(--dim);"></span>
    <div style="display:flex;align-items:center;gap:16px;">
      <span style="font-size:11px;color:var(--muted);" id="timeStr"></span>
    </div>
  </div>

  <div id="content">

    <!-- â”€â”€ ëŒ€ì‹œë³´ë“œ â”€â”€ -->
    <div class="tp active" id="tab-dash">
      <div class="section-header">
        <div>
          <div class="section-title">ğŸ“‹ DART ì „ìê³µì‹œ ì‹¤ì‹œê°„</div>
          <div class="section-sub" id="lastUpd">ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
        </div>
        <div style="display:flex;gap:8px;">
          <select id="daysSel" onchange="fetchDart()">
            <option value="3">ìµœê·¼ 3ì¼</option>
            <option value="7" selected>ìµœê·¼ 7ì¼</option>
            <option value="14">ìµœê·¼ 14ì¼</option>
            <option value="30">ìµœê·¼ 30ì¼</option>
          </select>
          <button class="btn btn-accent" onclick="fetchDart()">ğŸ”„ ìƒˆë¡œê³ ì¹¨</button>
        </div>
      </div>

      <!-- ë§ˆì¼“ ìš”ì•½ -->
      <div class="g4">
        <div class="card-sm"><div class="ct">KOSPI</div><div style="font-size:20px;font-weight:700;">2,634</div><div class="num-up">+1.2%</div></div>
        <div class="card-sm"><div class="ct">S&P 500</div><div style="font-size:20px;font-weight:700;">6,012</div><div class="num-dn">-0.3%</div></div>
        <div class="card-sm"><div class="ct">ì›/ë‹¬ëŸ¬</div><div style="font-size:20px;font-weight:700;">1,342</div><div class="num-up">+0.1%</div></div>
        <div class="card-sm"><div class="ct">VIX</div><div style="font-size:20px;font-weight:700;">14.2</div><div style="font-size:12px;color:var(--orange);">ë‚®ìŒ â†’ ê²½ê³„</div></div>
      </div>

      <!-- í•„í„° -->
      <div style="display:flex;gap:8px;flex-wrap:wrap;" id="cFilters"></div>

      <!-- ê³µì‹œ ëª©ë¡ -->
      <div id="dartBox"></div>

      <!-- í•˜ë‹¨ ì¹´ë“œ -->
      <div class="g2">
        <div class="card">
          <div class="ct">ê³µí¬ & íƒìš• ì§€ìˆ˜</div>
          <canvas id="gaugeC" width="220" height="120"></canvas>
          <p style="font-size:11px;color:var(--dim);text-align:center;margin-top:6px;font-style:italic;">"ì§€ê¸ˆì€ ê³µí¬ êµ¬ê°„ â€” í•˜ì›Œë“œ ë§‰ìŠ¤ ë§¤ìˆ˜ ì‹ í˜¸"</p>
        </div>
        <div class="card">
          <div class="ct">í¬íŠ¸í´ë¦¬ì˜¤ í˜„í™©</div>
          <canvas id="portC" height="140"></canvas>
        </div>
      </div>
    </div>

    <!-- â”€â”€ êµ­ì¥ ë¶„ì„ â”€â”€ -->
    <div class="tp" id="tab-kr">
      <div class="section-header">
        <div>
          <div class="section-title">ğŸ‡°ğŸ‡· êµ­ì¥ ìŠ¤í¬ë¦¬ë„ˆ â€” Draft 3.0 ê¸°ì¤€</div>
          <div class="section-sub">ROE â‰¥ 15% Â· PBR ì—…ì¢… ì´í•˜ Â· í•´ì Â· ì½”ë¦¬ì•„ ë””ìŠ¤ì¹´ìš´íŠ¸ í•„í„° Â· BB íƒ€ì´ë°</div>
        </div>
      </div>

      <!-- ì¢…ëª© ì¹´ë“œ ê·¸ë¦¬ë“œ -->
      <div class="stock-grid" id="krCards"></div>

      <!-- ìƒì„¸ ë¶„ì„ íŒ¨ë„ -->
      <div id="kr-detail" class="card" style="display:none;">
        <div id="kr-detail-content"></div>
      </div>
    </div>

    <!-- â”€â”€ ë¯¸ì¥ ë¶„ì„ â”€â”€ -->
    <div class="tp" id="tab-us">
      <div class="section-header">
        <div>
          <div class="section-title">ğŸ‡ºğŸ‡¸ ë¯¸ì¥ ìŠ¤í¬ë¦¬ë„ˆ â€” ìš°ëŸ‰ ì„±ì¥ì£¼</div>
          <div class="section-sub">ROIC > WACC Â· PEG Â· í•´ì ê°•ë„ Â· 10ë…„ ì„±ì¥ êµ¬ì¡° Â· í™˜ìœ¨ ì¸ì‹</div>
        </div>
      </div>
      <div class="stock-grid" id="usCards"></div>
      <div id="us-detail" class="card" style="display:none;">
        <div id="us-detail-content"></div>
      </div>
    </div>

    <!-- â”€â”€ ì±„ê¶ŒÂ·ì›ìì¬ â”€â”€ -->
    <div class="tp" id="tab-bonds">
      <div class="section-title" style="margin-bottom:4px;">â—† ì±„ê¶Œ Â· ì›ìì¬ â€” ë§¤í¬ë¡œ ì‚¬ì´í´</div>
      <div id="bondsBox"></div>
    </div>

    <!-- â”€â”€ íˆ¬ì ì¼ì§€ â”€â”€ -->
    <div class="tp" id="tab-journal">
      <div class="section-header">
        <div class="section-title">âœ íˆ¬ì ì¼ì§€</div>
        <button class="btn btn-accent">+ ìƒˆ ê¸°ë¡</button>
      </div>
      <div id="journalBox"></div>
    </div>

    <!-- â”€â”€ AI ë¶„ì„ â”€â”€ -->
    <div class="tp" id="tab-ai">
      <div class="section-title" style="margin-bottom:16px;">â¬¡ AI ì¢…ëª© ë¶„ì„ â€” Draft 3.0 ê¸°ë°˜</div>
      <div class="card" id="chat-wrap">
        <div id="chat-msgs">
          <div class="msg msg-s">ANDREW AI â€” ì‹¤ì œ DART ë°ì´í„° + Draft 3.0 ì² í•™ ê¸°ë°˜ ë¶„ì„. ì¢…ëª©ëª…, ê³µì‹œ í•´ì„, ë§¤í¬ë¡œ ì§ˆë¬¸ì„ í•´ë³´ì„¸ìš”.</div>
        </div>
        <div class="ci">
          <input id="chatIn" placeholder="ì˜ˆ: ì‚¼ì„±ì „ì ì§€ê¸ˆ ë§¤ìˆ˜í•´ë„ ë¼? / HBM ê´€ë ¨ ìˆ˜í˜œì£¼ ì•Œë ¤ì¤˜" onkeydown="if(event.key==='Enter')sendChat()">
          <button class="btn btn-accent" onclick="sendChat()">ì „ì†¡</button>
        </div>
      </div>
    </div>

  </div>
</div>

<script>
const BACKEND = "";
let dartData = [], activeFilter = "ì „ì²´", chatBusy = false;
let krSelected = null, usSelected = null;

// â”€â”€ ì‹œê°„ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
setInterval(() => {
  const n = new Date();
  document.getElementById("dateStr").textContent = n.toLocaleDateString("ko-KR",{year:"numeric",month:"long",day:"numeric",weekday:"long"});
  document.getElementById("timeStr").textContent = n.toLocaleTimeString("ko-KR");
},1000);

// â”€â”€ ë°±ì—”ë“œ ìƒíƒœ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function checkBackend() {
  try {
    await fetch(`${BACKEND}/`);
    document.getElementById("dot").className = "dot on";
    document.getElementById("stxt").textContent = "ë°±ì—”ë“œ ì—°ê²°ë¨";
  } catch {
    document.getElementById("dot").className = "dot off";
    document.getElementById("stxt").textContent = "ë°±ì—”ë“œ ì˜¤í”„ë¼ì¸";
  }
}
checkBackend();

// â”€â”€ íƒ­ ì „í™˜ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function go(id) {
  document.querySelectorAll(".tp").forEach(p => p.classList.remove("active"));
  document.querySelectorAll(".nb").forEach(b => b.classList.remove("active"));
  document.getElementById("tab-"+id).classList.add("active");
  document.getElementById("nav-"+id).classList.add("active");
  if(id==="dash") { fetchDart(); setTimeout(()=>{ drawGauge(32,"ê³µí¬"); drawPort(); },100); }
  if(id==="kr") renderKR();
  if(id==="us") renderUS();
  if(id==="bonds") renderBonds();
  if(id==="journal") renderJournal();
}

// â”€â”€ ê²Œì´ì§€ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function drawGauge(val, label) {
  const c = document.getElementById("gaugeC"); if(!c) return;
  const ctx = c.getContext("2d"), cx=110, cy=95, r=72;
  ctx.clearRect(0,0,220,120);
  const g = ctx.createLinearGradient(cx-r,0,cx+r,0);
  g.addColorStop(0,"#22c55e"); g.addColorStop(0.5,"#f59e0b"); g.addColorStop(1,"#ef4444");
  ctx.beginPath(); ctx.arc(cx,cy,r,Math.PI,0); ctx.strokeStyle="#1e2030"; ctx.lineWidth=12; ctx.stroke();
  ctx.beginPath(); ctx.arc(cx,cy,r,Math.PI,Math.PI+(val/100)*Math.PI); ctx.strokeStyle=g; ctx.lineWidth=12; ctx.lineCap="round"; ctx.stroke();
  const ang = Math.PI+(val/100)*Math.PI;
  const col = val<30?"#22c55e":val<50?"#f59e0b":"#ef4444";
  ctx.beginPath(); ctx.moveTo(cx,cy); ctx.lineTo(cx+(r-18)*Math.cos(ang),cy+(r-18)*Math.sin(ang)); ctx.strokeStyle=col; ctx.lineWidth=2.5; ctx.lineCap="round"; ctx.stroke();
  ctx.fillStyle=col; ctx.font="bold 22px sans-serif"; ctx.textAlign="center"; ctx.fillText(val,cx,cy+20);
  ctx.fillStyle="#6b7094"; ctx.font="11px sans-serif"; ctx.fillText(label,cx,cy+38);
}

// â”€â”€ í¬íŠ¸í´ë¦¬ì˜¤ íŒŒì´ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let portChart = null;
function drawPort() {
  const c = document.getElementById("portC"); if(!c) return;
  if(portChart) portChart.destroy();
  portChart = new Chart(c, {
    type:"doughnut",
    data:{
      labels:["êµ­ì¥ 42%","ë¯¸ì¥ 38%","í˜„ê¸ˆ 20%"],
      datasets:[{data:[42,38,20],backgroundColor:["#3b82f6","#22c55e","#4a4d6a"],borderWidth:0,hoverOffset:6}]
    },
    options:{
      responsive:true, maintainAspectRatio:false,
      plugins:{ legend:{ position:"right", labels:{ color:"#6b7094", font:{size:11}, padding:12 } } },
      cutout:"65%"
    }
  });
}

// â”€â”€ DART â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function fetchDart() {
  const days = document.getElementById("daysSel").value;
  document.getElementById("dartBox").innerHTML = '<div class="spin-wrap"><div class="spin"></div>ê³µì‹œ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>';
  try {
    const r = await fetch(`${BACKEND}/dart/recent?days=${days}`);
    const json = await r.json();
    dartData = json.data||[];
    document.getElementById("lastUpd").textContent = "ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸: "+new Date().toLocaleTimeString("ko-KR")+" Â· "+dartData.length+"ê±´";
    renderFilters();
    renderDart();
    setTimeout(()=>{ drawGauge(32,"ê³µí¬"); drawPort(); },100);
  } catch {
    document.getElementById("dartBox").innerHTML = `<div class="err"><p style="color:var(--red);font-weight:600;">âš ï¸ ë°±ì—”ë“œ ì—°ê²° ì‹¤íŒ¨</p><p style="font-size:11px;color:var(--dim);margin-top:4px;">${BACKEND} ì„œë²„ í™•ì¸</p></div>`;
  }
}

function renderFilters() {
  const cos = ["ì „ì²´",...new Set(dartData.map(d=>d.company))];
  document.getElementById("cFilters").innerHTML = cos.map(c=>`<button class="filter-btn${c===activeFilter?" active":""}" onclick="setF('${c}')">${c}</button>`).join("");
}

function setF(c) { activeFilter=c; renderFilters(); renderDart(); }

function renderDart() {
  const fd = activeFilter==="ì „ì²´"?dartData:dartData.filter(d=>d.company===activeFilter);
  const fmt = d => d?`${d.slice(0,4)}.${d.slice(4,6)}.${d.slice(6,8)}`:"";
  if(!fd.length) { document.getElementById("dartBox").innerHTML='<div class="card-sm" style="color:var(--muted);">ê³µì‹œ ì—†ìŒ</div>'; return; }
  document.getElementById("dartBox").innerHTML = `
    <p style="font-size:12px;color:var(--muted);margin-bottom:10px;">ì´ <b style="color:var(--accent);">${fd.length}ê±´</b></p>
    <div style="display:flex;flex-direction:column;gap:7px;">
    ${fd.map(d=>`
      <a class="di" href="${d.url}" target="_blank">
        <span class="badge ${d.type==="high"?"bh":d.type==="mid"?"bm":"bn"}">${d.type==="high"?"ğŸ”´ ì¤‘ìš”":d.type==="mid"?"ğŸŸ¡ ì£¼ëª©":"ì¼ë°˜"}</span>
        <span class="badge bb">${d.company}</span>
        <span style="flex:1;font-size:13px;">${d.title}</span>
        <span style="font-size:11px;color:var(--muted);">${fmt(d.date)}</span>
        <span style="color:var(--accent);font-size:12px;">â†—</span>
      </a>`).join("")}
    </div>`;
}

// â”€â”€ êµ­ì¥ ë°ì´í„° â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const KR = [
  {
    ticker:"005930", name:"ì‚¼ì„±ì „ì", sector:"ë°˜ë„ì²´",
    roe:18.2, pbr:1.1, evEbit:8.3, debt:32, moat:"ì›ê°€ìš°ìœ„", score:92, bb:"í•˜ë‹¨ì ‘ê·¼",
    discountType:"ì¼ì‹œì  ì•…ì¬", discountDetail:"ë©”ëª¨ë¦¬ ì‚¬ì´í´ ìš°ë ¤ë¡œ ì €í‰ê°€",
    buyPct:8, successProb:78, targetPrice:82000, currentPrice:65400,
    philosophy:{
      quality: { pass:true, label:"í€„ë¦¬í‹° âœ“", detail:"ROE 18.2% > 15% ê¸°ì¤€, ë°˜ë„ì²´ ì›ê°€ìš°ìœ„ í•´ì" },
      discount: { pass:true, label:"ë””ìŠ¤ì¹´ìš´íŠ¸ âœ“", detail:"ì¼ì‹œì  ì•…ì¬(ì‚¬ì´í´) â†’ êµ¬ì¡°ì  ë¬¸ì œ ì•„ë‹˜" },
      price: { pass:true, label:"ê°€ê²© âœ“", detail:"PBR 1.1x, EV/EBIT 8.3x â€” ì•ˆì „ë§ˆì§„ í™•ë³´" },
      macro: { pass:true, label:"ë§¤í¬ë¡œ âœ“", detail:"ê³µí¬ êµ¬ê°„(32) â€” í•˜ì›Œë“œ ë§‰ìŠ¤ ë§¤ìˆ˜ ì‹ í˜¸" },
      timing: { pass:true, label:"íƒ€ì´ë° âœ“", detail:"ë³¼ë¦°ì € ë°´ë“œ í•˜ë‹¨ ì ‘ê·¼" },
    },
    reason:"ìì‚¬ì£¼ ë§¤ì… + HBM4 ì–‘ì‚° ì „í™˜ ê¸°ëŒ€. ë©”ëª¨ë¦¬ ì‚¬ì´í´ ì €ì  + PBR 1.1ë¡œ ì—­ì‚¬ì  ì €í‰ê°€ êµ¬ê°„.",
    counter:"ì¤‘êµ­ ê²½ìŸì‚¬ CXMT ë¹ ë¥¸ ì¶”ê²©. ë©”ëª¨ë¦¬ ASP í•˜ë½ ì§€ì† ê°€ëŠ¥ì„±. CAPEX ë¶€ë‹´.",
    history:[63000,64200,62800,65100,64500,66200,65400],
    radarData:[90,85,88,75,92],
  },
  {
    ticker:"000660", name:"SKí•˜ì´ë‹‰ìŠ¤", sector:"ë°˜ë„ì²´",
    roe:22.5, pbr:1.4, evEbit:6.1, debt:45, moat:"ì „í™˜ë¹„ìš©", score:88, bb:"Squeeze",
    discountType:"ì‚¬ì´í´ ì €ì ", discountDetail:"HBM ë…ì£¼ ì²´ì œ ì €í‰ê°€",
    buyPct:7, successProb:74, targetPrice:195000, currentPrice:165000,
    philosophy:{
      quality: { pass:true, label:"í€„ë¦¬í‹° âœ“", detail:"ROE 22.5%, HBM ë…ì ì  ì§€ìœ„" },
      discount: { pass:true, label:"ë””ìŠ¤ì¹´ìš´íŠ¸ âœ“", detail:"ë©”ëª¨ë¦¬ ì‚¬ì´í´ ì €ì , êµ¬ì¡°ì  ë¬¸ì œ ì—†ìŒ" },
      price: { pass:true, label:"ê°€ê²© âœ“", detail:"EV/EBIT 6.1x â€” ì—…ì¢… ìµœì € ìˆ˜ì¤€" },
      macro: { pass:true, label:"ë§¤í¬ë¡œ âœ“", detail:"AI ì„œë²„ ìˆ˜ìš” ê¸‰ì¦ êµ¬ì¡°ì  í…Œë§ˆ" },
      timing: { pass:false, label:"íƒ€ì´ë° â–³", detail:"BB Squeeze â€” ë°©í–¥ì„± ì•„ì§ ë¶ˆëª…í™•" },
    },
    reason:"NVDA HBM3E ë…ì  ê³µê¸‰. HBM4 ì–‘ì‚° í™•ì •. AI ì„œë²„ ìˆ˜ìš” êµ¬ì¡°ì  ì„±ì¥.",
    counter:"TSMC ê²½ìŸ ì‹¬í™”. ì‚¼ì„± HBM ì¶”ê²©. ë¶€ì±„ë¹„ìœ¨ 45% ì£¼ì˜.",
    history:[158000,162000,160000,167000,163000,168000,165000],
    radarData:[88,82,90,70,75],
  },
  {
    ticker:"006400", name:"ì‚¼ì„±SDI", sector:"ë°°í„°ë¦¬",
    roe:14.1, pbr:0.9, evEbit:7.8, debt:38, moat:"ì „í™˜ë¹„ìš©", score:85, bb:"í•˜ë‹¨ì ‘ê·¼",
    discountType:"ì„¹í„° ì„¼í‹°ë¨¼íŠ¸", discountDetail:"EV ë‘”í™” ìš°ë ¤ë¡œ ê³¼ë„ í•˜ë½",
    buyPct:5, successProb:68, targetPrice:380000, currentPrice:285000,
    philosophy:{
      quality: { pass:false, label:"í€„ë¦¬í‹° â–³", detail:"ROE 14.1% â€” 15% ê¸°ì¤€ ë¯¸ë‹¬ (ê·¼ì ‘)" },
      discount: { pass:true, label:"ë””ìŠ¤ì¹´ìš´íŠ¸ âœ“", detail:"EV ì„¼í‹°ë¨¼íŠ¸ ì•…í™” â†’ ì¼ì‹œì " },
      price: { pass:true, label:"ê°€ê²© âœ“", detail:"PBR 0.9x â€” ìˆœìì‚° ì´í•˜" },
      macro: { pass:false, label:"ë§¤í¬ë¡œ â–³", detail:"EV ì„±ì¥ ë‘”í™” ìš°ë ¤ ì§€ì†" },
      timing: { pass:true, label:"íƒ€ì´ë° âœ“", detail:"ë³¼ë¦°ì € ë°´ë“œ í•˜ë‹¨ ì ‘ê·¼" },
    },
    reason:"PBR 0.9x ì—­ì‚¬ì  ì €ì . ì „ê³ ì²´ ë°°í„°ë¦¬ 2027 ì–‘ì‚°. BMW, ìŠ¤í…”ë€í‹°ìŠ¤ ìˆ˜ì£¼ íƒ„íƒ„.",
    counter:"EV ìˆ˜ìš” íšŒë³µ ì‹œê¸° ë¶ˆí™•ì‹¤. ì¤‘êµ­ CATL ê°€ê²© ê²½ìŸ. ROE 15% ë¯¸ë‹¬.",
    history:[295000,288000,278000,282000,275000,290000,285000],
    radarData:[75,88,70,65,82],
  },
  {
    ticker:"035420", name:"NAVER", sector:"í”Œë«í¼",
    roe:12.8, pbr:1.6, evEbit:14.2, debt:28, moat:"ë„¤íŠ¸ì›Œí¬", score:74, bb:"ì¤‘ë¦½",
    discountType:"ì„±ì¥ ë‘”í™” ìš°ë ¤", discountDetail:"ê´‘ê³  ìˆ˜ìµ ì„±ì¥ í•œê³„",
    buyPct:3, successProb:55, targetPrice:220000, currentPrice:185000,
    philosophy:{
      quality: { pass:false, label:"í€„ë¦¬í‹° â–³", detail:"ROE 12.8% â€” ê¸°ì¤€ ë¯¸ë‹¬" },
      discount: { pass:false, label:"ë””ìŠ¤ì¹´ìš´íŠ¸ â–³", detail:"ì„±ì¥ ë‘”í™” ì¼ì‹œì ì¸ì§€ êµ¬ì¡°ì ì¸ì§€ ë¶ˆëª…í™•" },
      price: { pass:false, label:"ê°€ê²© â–³", detail:"EV/EBIT 14.2x â€” í”„ë¦¬ë¯¸ì—„ ê³¼ë‹¤" },
      macro: { pass:true, label:"ë§¤í¬ë¡œ âœ“", detail:"AI ê²€ìƒ‰ ì „í™˜ ê¸°íšŒ" },
      timing: { pass:false, label:"íƒ€ì´ë° â–³", detail:"BB ì¤‘ë¦½ â€” ëª…í™•í•œ ì‹ í˜¸ ì—†ìŒ" },
    },
    reason:"ë¼ì¸ì•¼í›„ ì§€ë¶„ ì¬í¸. HyperCLOVA AI ì»¤ë¨¸ìŠ¤ ì ìš©. ë„¤ì´ë²„ì›¹íˆ° IP í™•ì¥.",
    counter:"êµ¬ê¸€ AI ê²€ìƒ‰ ì ìœ ìœ¨ ì ì‹. ì¹´ì¹´ì˜¤ ê²½ìŸ. ROE ì§€ì† í•˜ë½ ì¶”ì„¸.",
    history:[192000,188000,183000,187000,181000,189000,185000],
    radarData:[60,55,58,70,55],
  },
  {
    ticker:"051910", name:"LGí™”í•™", sector:"í™”í•™",
    roe:8.3, pbr:0.7, evEbit:11.5, debt:65, moat:"ì›ê°€ìš°ìœ„", score:45, bb:"í•˜ë‹¨ì´íƒˆ",
    discountType:"êµ¬ì¡°ì  ë¬¸ì œ", discountDetail:"ì§€ë°°êµ¬ì¡° + ì‚¬ì—… êµ¬ì¡° ê°œí¸ ë¶ˆí™•ì‹¤ì„±",
    buyPct:0, successProb:35, targetPrice:350000, currentPrice:265000,
    philosophy:{
      quality: { pass:false, label:"í€„ë¦¬í‹° âœ—", detail:"ROE 8.3% â€” ê¸°ì¤€ í¬ê²Œ ë¯¸ë‹¬" },
      discount: { pass:false, label:"ë””ìŠ¤ì¹´ìš´íŠ¸ âœ—", detail:"êµ¬ì¡°ì  ë¬¸ì œ â†’ íˆ¬ì ì œì™¸" },
      price: { pass:true, label:"ê°€ê²© âœ“", detail:"PBR 0.7x ì €í‰ê°€ì§€ë§Œ ê°€ì¹˜í•¨ì • ìœ„í—˜" },
      macro: { pass:false, label:"ë§¤í¬ë¡œ âœ—", detail:"ì„ìœ í™”í•™ ì—…í™© ì¥ê¸° ì¹¨ì²´" },
      timing: { pass:false, label:"íƒ€ì´ë° âœ—", detail:"BB í•˜ë‹¨ ì´íƒˆ â€” ì¶”ì„¸ í•˜ë½" },
    },
    reason:"PBR 0.7x ì—­ì‚¬ì  ì €ì . ë°°í„°ë¦¬ ì†Œì¬ ìíšŒì‚¬ LGì—ë„ˆì§€ì†”ë£¨ì…˜ ê°€ì¹˜.",
    counter:"ë¶€ì±„ë¹„ìœ¨ 65%. ì§€ë°°êµ¬ì¡° ë””ìŠ¤ì¹´ìš´íŠ¸. êµ¬ì¡°ì  ì—…í™© ì•…í™”. Draft 3.0 ê¸°ì¤€ íˆ¬ì ì œì™¸.",
    history:[285000,278000,271000,268000,260000,263000,265000],
    radarData:[40,35,55,30,35],
  },
  {
    ticker:"207940", name:"ì‚¼ì„±ë°”ì´ì˜¤ë¡œì§ìŠ¤", sector:"ë°”ì´ì˜¤",
    roe:16.8, pbr:5.2, evEbit:42.1, debt:22, moat:"ì „í™˜ë¹„ìš©", score:70, bb:"ì¤‘ë¦½",
    discountType:"ê³ í‰ê°€", discountDetail:"ì•ˆì „ë§ˆì§„ ë¶€ì¡±",
    buyPct:0, successProb:48, targetPrice:980000, currentPrice:870000,
    philosophy:{
      quality: { pass:true, label:"í€„ë¦¬í‹° âœ“", detail:"ROE 16.8%, CDMO ì‹œì¥ ë…ì ì  ì§€ìœ„" },
      discount: { pass:false, label:"ë””ìŠ¤ì¹´ìš´íŠ¸ âœ—", detail:"ê³ í‰ê°€ â†’ ì•ˆì „ë§ˆì§„ ì—†ìŒ" },
      price: { pass:false, label:"ê°€ê²© âœ—", detail:"PBR 5.2x, EV/EBIT 42x â€” ê³¼ëŒ€í‰ê°€" },
      macro: { pass:true, label:"ë§¤í¬ë¡œ âœ“", detail:"ê¸€ë¡œë²Œ ë°”ì´ì˜¤ ì•„ì›ƒì†Œì‹± ìˆ˜ìš” ì¦ê°€" },
      timing: { pass:false, label:"íƒ€ì´ë° â–³", detail:"BB ì¤‘ë¦½" },
    },
    reason:"ê¸€ë¡œë²Œ 5ìœ„ CDMO. 5ê³µì¥ ì¦ì„¤. ìˆ˜ì£¼ ì”ê³  ì—­ëŒ€ ìµœê³ .",
    counter:"PBR 5.2x â€” ì•ˆì „ë§ˆì§„ ì—†ìŒ. ì ì • ì£¼ê°€ ëŒ€ë¹„ ê³ í‰ê°€. Draft 3.0: í•˜ë½ ê¸°ë‹¤ë¦´ ê²ƒ.",
    history:[850000,862000,875000,858000,880000,865000,870000],
    radarData:[75,30,25,72,55],
  },
];

// â”€â”€ êµ­ì¥ ë Œë” â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderKR() {
  document.getElementById("krCards").innerHTML = KR.map((s,i) => {
    const matchScore = Object.values(s.philosophy).filter(p=>p.pass).length;
    const scoreColor = s.score>=80?"var(--green)":s.score>=60?"var(--orange)":"var(--red)";
    const probColor = s.successProb>=70?"var(--green)":s.successProb>=55?"var(--orange)":"var(--red)";
    return `
    <div class="stock-card${krSelected===i?" selected":""}" onclick="selectKR(${i})">
      <div style="display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:12px;">
        <div>
          <div style="font-size:15px;font-weight:700;">${s.name}</div>
          <div style="font-size:10px;color:var(--muted);margin-top:2px;">${s.ticker} Â· ${s.sector}</div>
        </div>
        <span class="badge ba" style="font-size:13px;padding:4px 10px;">${s.score}</span>
      </div>

      <!-- ì² í•™ ë§¤ì¹­ -->
      <div style="margin-bottom:12px;">
        <div style="display:flex;justify-content:space-between;margin-bottom:4px;">
          <span style="font-size:11px;color:var(--muted);">Draft 3.0 ë§¤ì¹­</span>
          <span style="font-size:11px;font-weight:700;color:${scoreColor};">${matchScore}/5</span>
        </div>
        <div class="match-bar"><div class="match-fill" style="width:${matchScore/5*100}%;"></div></div>
        <div style="display:flex;gap:4px;margin-top:6px;">
          ${Object.values(s.philosophy).map(p=>`<span style="width:28px;height:4px;border-radius:2px;background:${p.pass?"var(--green)":"var(--red)"};display:inline-block;"></span>`).join("")}
        </div>
      </div>

      <!-- í•µì‹¬ ì§€í‘œ -->
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:6px;margin-bottom:12px;">
        <div style="background:var(--surface2);border-radius:6px;padding:7px;">
          <div style="font-size:9px;color:var(--muted);">ROE</div>
          <div style="font-size:13px;font-weight:700;color:${s.roe>=15?"var(--green)":"var(--orange)"};">${s.roe}%</div>
        </div>
        <div style="background:var(--surface2);border-radius:6px;padding:7px;">
          <div style="font-size:9px;color:var(--muted);">PBR</div>
          <div style="font-size:13px;font-weight:700;color:${s.pbr<=1.2?"var(--green)":"var(--text)"};">${s.pbr}x</div>
        </div>
        <div style="background:var(--surface2);border-radius:6px;padding:7px;">
          <div style="font-size:9px;color:var(--muted);">ë§¤ìˆ˜ ë¹„ì¤‘</div>
          <div style="font-size:13px;font-weight:700;color:${s.buyPct>0?"var(--accent)":"var(--muted)"};">${s.buyPct>0?s.buyPct+"% ê¶Œì¥":"ì œì™¸"}</div>
        </div>
        <div style="background:var(--surface2);border-radius:6px;padding:7px;">
          <div style="font-size:9px;color:var(--muted);">ì„±ê³µí™•ë¥ </div>
          <div style="font-size:13px;font-weight:700;color:${probColor};">${s.successProb}%</div>
        </div>
      </div>

      <!-- ì„±ê³µí™•ë¥  ë°” -->
      <div>
        <div style="display:flex;justify-content:space-between;margin-bottom:4px;">
          <span style="font-size:10px;color:var(--muted);">ëª©í‘œê°€ ë„ë‹¬ í™•ë¥  (12M)</span>
          <span style="font-size:10px;font-weight:700;color:${probColor};">${s.successProb}%</span>
        </div>
        <div class="prob-bar"><div class="prob-fill" style="width:${s.successProb}%;background:${probColor};"></div></div>
      </div>

      <div style="margin-top:10px;font-size:10px;color:var(--accent);text-align:center;">í´ë¦­í•˜ì—¬ ìƒì„¸ ë¶„ì„ ë³´ê¸° â†“</div>
    </div>`;
  }).join("");
}

function selectKR(i) {
  krSelected = krSelected===i?null:i;
  renderKR();
  const panel = document.getElementById("kr-detail");
  if(krSelected===null) { panel.style.display="none"; return; }
  panel.style.display="block";
  renderKRDetail(KR[i]);
  panel.scrollIntoView({behavior:"smooth",block:"start"});
}

let radarChart = null, priceChart = null;
function renderKRDetail(s) {
  const scoreColor = s.score>=80?"var(--green)":s.score>=60?"var(--orange)":"var(--red)";
  document.getElementById("kr-detail-content").innerHTML = `
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:18px;">
      <div>
        <div style="font-size:18px;font-weight:700;">${s.name} <span style="font-size:13px;color:var(--muted);font-weight:400;">${s.ticker}</span></div>
        <div style="font-size:12px;color:var(--muted);margin-top:2px;">${s.sector} Â· ëª©í‘œê°€ â‚©${s.targetPrice.toLocaleString()}</div>
      </div>
      <div style="text-align:right;">
        <div style="font-size:28px;font-weight:800;color:${scoreColor};">${s.score}</div>
        <div style="font-size:10px;color:var(--muted);">ì¢…í•© ì ìˆ˜</div>
      </div>
    </div>

    <div class="g2" style="margin-bottom:16px;">
      <!-- ì°¨íŠ¸ -->
      <div>
        <div style="font-size:11px;color:var(--muted);margin-bottom:8px;">ìµœê·¼ 7ì¼ ì£¼ê°€</div>
        <canvas id="priceC" height="160"></canvas>
      </div>
      <div>
        <div style="font-size:11px;color:var(--muted);margin-bottom:8px;">Draft 3.0 ì ìˆ˜ ë ˆì´ë”</div>
        <canvas id="radarC" height="160"></canvas>
      </div>
    </div>

    <!-- ë§¤ìˆ˜ ë¹„ì¤‘ & ì„±ê³µí™•ë¥  -->
    <div class="g2" style="margin-bottom:16px;">
      <div class="card-sm">
        <div class="ct">ê¶Œì¥ ë§¤ìˆ˜ ë¹„ì¤‘</div>
        <div style="font-size:32px;font-weight:800;color:${s.buyPct>0?"var(--accent)":"var(--muted)"};">${s.buyPct>0?s.buyPct+"%":"ì œì™¸"}</div>
        <div style="font-size:11px;color:var(--dim);margin-top:4px;">${s.buyPct>0?"í¬íŠ¸í´ë¦¬ì˜¤ ëŒ€ë¹„ ë¶„í• ë§¤ìˆ˜ ê¶Œì¥":"Draft 3.0 ê¸°ì¤€ ë¯¸ì¶©ì¡±"}</div>
        ${s.buyPct>0?`<div class="prob-bar" style="margin-top:8px;height:8px;"><div class="prob-fill" style="width:${s.buyPct*10}%;background:var(--accent);"></div></div>`:""}
      </div>
      <div class="card-sm">
        <div class="ct">ëª©í‘œê°€ ë„ë‹¬ ì„±ê³µí™•ë¥  (12M)</div>
        <div style="font-size:32px;font-weight:800;color:${s.successProb>=70?"var(--green)":s.successProb>=55?"var(--orange)":"var(--red)"};">${s.successProb}%</div>
        <div style="font-size:11px;color:var(--dim);margin-top:4px;">í˜„ì¬ â‚©${s.currentPrice.toLocaleString()} â†’ ëª©í‘œ â‚©${s.targetPrice.toLocaleString()} (+${Math.round((s.targetPrice/s.currentPrice-1)*100)}%)</div>
        <div class="prob-bar" style="margin-top:8px;height:8px;"><div class="prob-fill" style="width:${s.successProb}%;background:${s.successProb>=70?"var(--green)":s.successProb>=55?"var(--orange)":"var(--red)"};"></div></div>
      </div>
    </div>

    <!-- Draft 3.0 ì²´í¬ë¦¬ìŠ¤íŠ¸ -->
    <div style="margin-bottom:16px;">
      <div style="font-size:12px;font-weight:600;margin-bottom:8px;">Draft 3.0 ì²´í¬ë¦¬ìŠ¤íŠ¸</div>
      <div class="checklist">
        ${Object.values(s.philosophy).map(p=>`
          <div class="check-item ${p.pass?"pass":"fail"}">
            <span style="font-size:16px;">${p.pass?"âœ“":"âœ—"}</span>
            <div>
              <div style="font-size:12px;font-weight:600;color:${p.pass?"var(--green)":"var(--red)"};">${p.label}</div>
              <div style="font-size:11px;color:var(--dim);">${p.detail}</div>
            </div>
          </div>`).join("")}
      </div>
    </div>

    <!-- íˆ¬ì ë…¼ë¦¬ & ë°˜ë¡  -->
    <div class="g2">
      <div style="padding:14px;background:var(--green-dim);border-radius:10px;border-left:3px solid var(--green);">
        <div style="font-size:10px;font-weight:700;color:var(--green);margin-bottom:6px;">ğŸ“ˆ íˆ¬ì ë…¼ë¦¬</div>
        <div style="font-size:12px;line-height:1.7;">${s.reason}</div>
      </div>
      <div style="padding:14px;background:var(--red-dim);border-radius:10px;border-left:3px solid var(--red);">
        <div style="font-size:10px;font-weight:700;color:var(--red);margin-bottom:6px;">âš ï¸ ë°˜ë¡  (ë‚´ê°€ ì™œ í‹€ë¦´ ìˆ˜ ìˆë‚˜)</div>
        <div style="font-size:12px;line-height:1.7;">${s.counter}</div>
      </div>
    </div>
  `;

  // ì£¼ê°€ ì°¨íŠ¸
  setTimeout(() => {
    if(priceChart) priceChart.destroy();
    priceChart = new Chart(document.getElementById("priceC"), {
      type:"line",
      data:{
        labels:["7ì¼ì „","6ì¼ì „","5ì¼ì „","4ì¼ì „","3ì¼ì „","2ì¼ì „","ì˜¤ëŠ˜"],
        datasets:[{
          data:s.history, fill:true,
          borderColor:"#c9a55a", backgroundColor:"rgba(201,165,90,0.1)",
          tension:0.4, pointRadius:3, pointBackgroundColor:"#c9a55a", borderWidth:2
        }]
      },
      options:{
        responsive:true, maintainAspectRatio:false,
        plugins:{legend:{display:false}},
        scales:{
          x:{grid:{color:"#1e2030"},ticks:{color:"#4a4d6a",font:{size:9}}},
          y:{grid:{color:"#1e2030"},ticks:{color:"#4a4d6a",font:{size:9},callback:v=>v.toLocaleString()}}
        }
      }
    });

    if(radarChart) radarChart.destroy();
    radarChart = new Chart(document.getElementById("radarC"), {
      type:"radar",
      data:{
        labels:["í€„ë¦¬í‹°","ë””ìŠ¤ì¹´ìš´íŠ¸","ê°€ê²©","ë§¤í¬ë¡œ","íƒ€ì´ë°"],
        datasets:[{
          data:s.radarData, fill:true,
          borderColor:"#c9a55a", backgroundColor:"rgba(201,165,90,0.15)",
          pointBackgroundColor:"#c9a55a", borderWidth:2
        }]
      },
      options:{
        responsive:true, maintainAspectRatio:false,
        plugins:{legend:{display:false}},
        scales:{r:{
          min:0, max:100,
          grid:{color:"#1e2030"},
          ticks:{display:false},
          pointLabels:{color:"#6b7094",font:{size:10}}
        }}
      }
    });
  }, 50);
}

// â”€â”€ ë¯¸ì¥ ë°ì´í„° â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const US = [
  {
    ticker:"MSFT", name:"Microsoft", sector:"í´ë¼ìš°ë“œ/AI",
    roic:42.3, peg:1.8, moat:"ì „í™˜ë¹„ìš©+ë„¤íŠ¸ì›Œí¬", score:94, phase:"ë³´ìœ  ìœ ì§€",
    buyPct:10, successProb:82, targetPrice:480, currentPrice:415,
    reason:"Azure 30%+ ì„±ì¥. Copilot AI ì „ ì œí’ˆ íƒ‘ì¬. Office 365 ì „í™˜ë¹„ìš© í•´ì ê°•ë ¥.",
    counter:"Valuation ë¶€ë‹´(PE 35x). OpenAI ì˜ì¡´ ë¦¬ìŠ¤í¬. ê·œì œ ë¦¬ìŠ¤í¬ ì¦ê°€.",
    history:[408,412,409,418,414,420,415],
    radarData:[95,80,78,90,85],
    philosophy:{
      quality:{pass:true,label:"í€„ë¦¬í‹° âœ“",detail:"ROIC 42.3%, ì „í™˜ë¹„ìš©+ë„¤íŠ¸ì›Œí¬ í•´ì"},
      discount:{pass:true,label:"ë””ìŠ¤ì¹´ìš´íŠ¸ âœ“",detail:"AI ì „í™˜ ê³¼ì†Œí‰ê°€ â€” ì¼ì‹œì "},
      price:{pass:true,label:"ê°€ê²© âœ“",detail:"PEG 1.8x â€” ì„±ì¥ ëŒ€ë¹„ í•©ë¦¬ì "},
      macro:{pass:true,label:"ë§¤í¬ë¡œ âœ“",detail:"AI ì¸í”„ë¼ ì¥ê¸° ì„±ì¥ í…Œë§ˆ"},
      timing:{pass:true,label:"íƒ€ì´ë° âœ“",detail:"52ì£¼ ê³ ì  ëŒ€ë¹„ ì¡°ì • í›„ ë§¤ìˆ˜ ê¸°íšŒ"},
    }
  },
  {
    ticker:"AAPL", name:"Apple", sector:"ì†Œë¹„ì ê¸°ìˆ ",
    roic:58.2, peg:2.1, moat:"ë¸Œëœë“œ+ìƒíƒœê³„", score:90, phase:"ë³´ìœ  ìœ ì§€",
    buyPct:8, successProb:76, targetPrice:250, currentPrice:218,
    reason:"ì„œë¹„ìŠ¤ ë§¤ì¶œ 30%+ ì„±ì¥. ìƒíƒœê³„ ì „í™˜ë¹„ìš©. Apple Intelligence AI íƒ‘ì¬.",
    counter:"ì¤‘êµ­ ë§¤ì¶œ ì˜ì¡´ë„ 30%. ì•„ì´í° êµì²´ ì‚¬ì´í´ ì—°ì¥. PEG 2.1 ë‹¤ì†Œ ë¶€ë‹´.",
    history:[212,215,210,220,216,222,218],
    radarData:[92,72,70,85,80],
    philosophy:{
      quality:{pass:true,label:"í€„ë¦¬í‹° âœ“",detail:"ROIC 58.2% â€” ì„¸ê³„ ìµœê³  ìˆ˜ì¤€"},
      discount:{pass:true,label:"ë””ìŠ¤ì¹´ìš´íŠ¸ âœ“",detail:"ì¤‘êµ­ ë¦¬ìŠ¤í¬ ê³¼ëŒ€ ë°˜ì˜"},
      price:{pass:false,label:"ê°€ê²© â–³",detail:"PEG 2.1x â€” ì•½ê°„ ê³ í‰ê°€"},
      macro:{pass:true,label:"ë§¤í¬ë¡œ âœ“",detail:"AI ì˜¨ë””ë°”ì´ìŠ¤ ì„ ë„"},
      timing:{pass:true,label:"íƒ€ì´ë° âœ“",detail:"52ì£¼ ê³ ì  ëŒ€ë¹„ ì¡°ì • êµ¬ê°„"},
    }
  },
  {
    ticker:"GOOGL", name:"Alphabet", sector:"ê´‘ê³ /AI/í´ë¼ìš°ë“œ",
    roic:32.5, peg:1.2, moat:"ë„¤íŠ¸ì›Œí¬+ë°ì´í„°", score:91, phase:"ì§„ì… ê°€ëŠ¥",
    buyPct:9, successProb:80, targetPrice:230, currentPrice:193,
    reason:"PEG 1.2x â€” ë¹…í…Œí¬ ì¤‘ ê°€ì¥ ì €í‰ê°€. Google Cloud 28% ì„±ì¥. Gemini AI ê²€ìƒ‰ í†µí•©.",
    counter:"AI ê²€ìƒ‰ ìê¸°ì ì‹ ìœ„í—˜. ê´‘ê³  ê·œì œ ë¦¬ìŠ¤í¬. DOJ ë°˜ë…ì  ì†Œì†¡.",
    history:[185,189,183,195,191,196,193],
    radarData:[88,85,92,82,80],
    philosophy:{
      quality:{pass:true,label:"í€„ë¦¬í‹° âœ“",detail:"ROIC 32.5%, ê²€ìƒ‰ ë…ì  ë„¤íŠ¸ì›Œí¬ í•´ì"},
      discount:{pass:true,label:"ë””ìŠ¤ì¹´ìš´íŠ¸ âœ“",detail:"AI ìê¸°ì ì‹ ìš°ë ¤ ê³¼ëŒ€ ë°˜ì˜"},
      price:{pass:true,label:"ê°€ê²© âœ“",detail:"PEG 1.2x â€” ë¹…í…Œí¬ ìµœì €"},
      macro:{pass:true,label:"ë§¤í¬ë¡œ âœ“",detail:"í´ë¼ìš°ë“œ + AI ê²€ìƒ‰ ì „í™˜ ìˆ˜í˜œ"},
      timing:{pass:true,label:"íƒ€ì´ë° âœ“",detail:"52ì£¼ ì €ì  ê·¼ì²˜"},
    }
  },
  {
    ticker:"V", name:"Visa", sector:"ê¸ˆìœµ ë„¤íŠ¸ì›Œí¬",
    roic:44.8, peg:1.5, moat:"ë„¤íŠ¸ì›Œí¬íš¨ê³¼", score:89, phase:"ë³´ìœ  ìœ ì§€",
    buyPct:7, successProb:75, targetPrice:320, currentPrice:285,
    reason:"ê¸€ë¡œë²Œ ê²°ì œ ë„¤íŠ¸ì›Œí¬ ë…ì . ROIC 44.8%. ì¸í”Œë ˆì´ì…˜ ìë™ í—¤ì§€.",
    counter:"í•€í…Œí¬ ê²½ìŸ(Stripe, Block). ê°€ë§¹ì  ìˆ˜ìˆ˜ë£Œ ê·œì œ ë¦¬ìŠ¤í¬.",
    history:[278,282,279,288,283,290,285],
    radarData:[90,75,80,85,78],
    philosophy:{
      quality:{pass:true,label:"í€„ë¦¬í‹° âœ“",detail:"ROIC 44.8%, ê²°ì œ ë„¤íŠ¸ì›Œí¬ ë…ì "},
      discount:{pass:true,label:"ë””ìŠ¤ì¹´ìš´íŠ¸ âœ“",detail:"í•€í…Œí¬ ìœ„í˜‘ ê³¼ëŒ€ ë°˜ì˜"},
      price:{pass:true,label:"ê°€ê²© âœ“",detail:"PEG 1.5x â€” í•©ë¦¬ì "},
      macro:{pass:true,label:"ë§¤í¬ë¡œ âœ“",detail:"ê¸€ë¡œë²Œ ë””ì§€í„¸ ê²°ì œ ì„±ì¥"},
      timing:{pass:false,label:"íƒ€ì´ë° â–³",detail:"BB ì¤‘ë¦½"},
    }
  },
  {
    ticker:"COST", name:"Costco", sector:"ìœ í†µ",
    roic:28.1, peg:2.8, moat:"ì›ê°€ìš°ìœ„+ë¸Œëœë“œ", score:78, phase:"ê³ í‰ê°€ ì£¼ì˜",
    buyPct:0, successProb:45, targetPrice:900, currentPrice:975,
    reason:"ë©¤ë²„ì‹­ ëª¨ë¸ ê°•ë ¥í•œ í•´ì. ê²½ê¸° ë°©ì–´ì . ROE 28%.",
    counter:"PEG 2.8x â€” ê³¼ëŒ€í‰ê°€. í˜„ì¬ê°€ ëŒ€ë¹„ ëª©í‘œê°€ í•˜íšŒ. Draft 3.0: í•˜ë½ ê¸°ë‹¤ë¦´ ê²ƒ.",
    history:[955,962,970,958,980,968,975],
    radarData:[80,40,35,75,45],
    philosophy:{
      quality:{pass:true,label:"í€„ë¦¬í‹° âœ“",detail:"ROIC 28.1%, ë©¤ë²„ì‹­ í•´ì"},
      discount:{pass:false,label:"ë””ìŠ¤ì¹´ìš´íŠ¸ âœ—",detail:"ê³ í‰ê°€ â€” ì•ˆì „ë§ˆì§„ ì—†ìŒ"},
      price:{pass:false,label:"ê°€ê²© âœ—",detail:"PEG 2.8x â€” ê³¼ëŒ€í‰ê°€"},
      macro:{pass:true,label:"ë§¤í¬ë¡œ âœ“",detail:"ê²½ê¸° ë°©ì–´ì "},
      timing:{pass:false,label:"íƒ€ì´ë° âœ—",detail:"52ì£¼ ê³ ì  ê·¼ì²˜"},
    }
  },
];

function renderUS() {
  document.getElementById("usCards").innerHTML = US.map((s,i) => {
    const matchScore = Object.values(s.philosophy).filter(p=>p.pass).length;
    const sc = s.score>=80?"var(--green)":s.score>=60?"var(--orange)":"var(--red)";
    const pc = s.successProb>=70?"var(--green)":s.successProb>=55?"var(--orange)":"var(--red)";
    return `
    <div class="stock-card${usSelected===i?" selected":""}" onclick="selectUS(${i})">
      <div style="display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:12px;">
        <div>
          <div style="font-size:15px;font-weight:700;">${s.name}</div>
          <div style="font-size:10px;color:var(--muted);margin-top:2px;">${s.ticker} Â· ${s.sector}</div>
        </div>
        <span class="badge ba" style="font-size:13px;padding:4px 10px;">${s.score}</span>
      </div>
      <div style="margin-bottom:12px;">
        <div style="display:flex;justify-content:space-between;margin-bottom:4px;">
          <span style="font-size:11px;color:var(--muted);">Draft 3.0 ë§¤ì¹­</span>
          <span style="font-size:11px;font-weight:700;color:${sc};">${matchScore}/5</span>
        </div>
        <div class="match-bar"><div class="match-fill" style="width:${matchScore/5*100}%;"></div></div>
        <div style="display:flex;gap:4px;margin-top:6px;">
          ${Object.values(s.philosophy).map(p=>`<span style="width:28px;height:4px;border-radius:2px;background:${p.pass?"var(--green)":"var(--red)"};display:inline-block;"></span>`).join("")}
        </div>
      </div>
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:6px;margin-bottom:12px;">
        <div style="background:var(--surface2);border-radius:6px;padding:7px;">
          <div style="font-size:9px;color:var(--muted);">ROIC</div>
          <div style="font-size:13px;font-weight:700;color:${s.roic>=30?"var(--green)":"var(--orange)"};">${s.roic}%</div>
        </div>
        <div style="background:var(--surface2);border-radius:6px;padding:7px;">
          <div style="font-size:9px;color:var(--muted);">PEG</div>
          <div style="font-size:13px;font-weight:700;color:${s.peg<=1.5?"var(--green)":s.peg<=2?"var(--text)":"var(--orange)"};">${s.peg}x</div>
        </div>
        <div style="background:var(--surface2);border-radius:6px;padding:7px;">
          <div style="font-size:9px;color:var(--muted);">ë§¤ìˆ˜ ë¹„ì¤‘</div>
          <div style="font-size:13px;font-weight:700;color:${s.buyPct>0?"var(--accent)":"var(--muted)"};">${s.buyPct>0?s.buyPct+"% ê¶Œì¥":"ì œì™¸"}</div>
        </div>
        <div style="background:var(--surface2);border-radius:6px;padding:7px;">
          <div style="font-size:9px;color:var(--muted);">ì„±ê³µí™•ë¥ </div>
          <div style="font-size:13px;font-weight:700;color:${pc};">${s.successProb}%</div>
        </div>
      </div>
      <div>
        <div style="display:flex;justify-content:space-between;margin-bottom:4px;">
          <span style="font-size:10px;color:var(--muted);">ëª©í‘œê°€ ë„ë‹¬ í™•ë¥  (12M)</span>
          <span style="font-size:10px;font-weight:700;color:${pc};">${s.successProb}%</span>
        </div>
        <div class="prob-bar"><div class="prob-fill" style="width:${s.successProb}%;background:${pc};"></div></div>
      </div>
      <div style="margin-top:10px;font-size:10px;color:var(--accent);text-align:center;">í´ë¦­í•˜ì—¬ ìƒì„¸ ë¶„ì„ ë³´ê¸° â†“</div>
    </div>`;
  }).join("");
}

let usRadar = null, usPrice = null;
function selectUS(i) {
  usSelected = usSelected===i?null:i;
  renderUS();
  const panel = document.getElementById("us-detail");
  if(usSelected===null) { panel.style.display="none"; return; }
  panel.style.display="block";
  const s = US[i];
  const sc = s.score>=80?"var(--green)":s.score>=60?"var(--orange)":"var(--red)";
  const pc = s.successProb>=70?"var(--green)":s.successProb>=55?"var(--orange)":"var(--red)";
  document.getElementById("us-detail-content").innerHTML = `
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:18px;">
      <div>
        <div style="font-size:18px;font-weight:700;">${s.name} <span style="font-size:13px;color:var(--muted);font-weight:400;">${s.ticker}</span></div>
        <div style="font-size:12px;color:var(--muted);margin-top:2px;">${s.sector} Â· ëª©í‘œê°€ $${s.targetPrice}</div>
      </div>
      <div style="text-align:right;">
        <div style="font-size:28px;font-weight:800;color:${sc};">${s.score}</div>
        <div style="font-size:10px;color:var(--muted);">ì¢…í•© ì ìˆ˜</div>
      </div>
    </div>
    <div class="g2" style="margin-bottom:16px;">
      <div><div style="font-size:11px;color:var(--muted);margin-bottom:8px;">ìµœê·¼ 7ì¼ ì£¼ê°€ ($)</div><canvas id="usPriceC" height="160"></canvas></div>
      <div><div style="font-size:11px;color:var(--muted);margin-bottom:8px;">Draft 3.0 ë ˆì´ë”</div><canvas id="usRadarC" height="160"></canvas></div>
    </div>
    <div class="g2" style="margin-bottom:16px;">
      <div class="card-sm">
        <div class="ct">ê¶Œì¥ ë§¤ìˆ˜ ë¹„ì¤‘</div>
        <div style="font-size:32px;font-weight:800;color:${s.buyPct>0?"var(--accent)":"var(--muted)"};">${s.buyPct>0?s.buyPct+"%":"ì œì™¸"}</div>
        <div style="font-size:11px;color:var(--dim);margin-top:4px;">${s.buyPct>0?"ë¶„í• ë§¤ìˆ˜ ê¶Œì¥":"í˜„ì¬ ê°€ê²© ê³ í‰ê°€"}</div>
      </div>
      <div class="card-sm">
        <div class="ct">ì„±ê³µí™•ë¥  (12M)</div>
        <div style="font-size:32px;font-weight:800;color:${pc};">${s.successProb}%</div>
        <div style="font-size:11px;color:var(--dim);margin-top:4px;">$${s.currentPrice} â†’ $${s.targetPrice} (+${Math.round((s.targetPrice/s.currentPrice-1)*100)}%)</div>
        <div class="prob-bar" style="margin-top:8px;height:8px;"><div class="prob-fill" style="width:${s.successProb}%;background:${pc};"></div></div>
      </div>
    </div>
    <div style="margin-bottom:16px;">
      <div style="font-size:12px;font-weight:600;margin-bottom:8px;">Draft 3.0 ì²´í¬ë¦¬ìŠ¤íŠ¸</div>
      <div class="checklist">
        ${Object.values(s.philosophy).map(p=>`
          <div class="check-item ${p.pass?"pass":"fail"}">
            <span style="font-size:16px;">${p.pass?"âœ“":"âœ—"}</span>
            <div><div style="font-size:12px;font-weight:600;color:${p.pass?"var(--green)":"var(--red)"};">${p.label}</div><div style="font-size:11px;color:var(--dim);">${p.detail}</div></div>
          </div>`).join("")}
      </div>
    </div>
    <div class="g2">
      <div style="padding:14px;background:var(--green-dim);border-radius:10px;border-left:3px solid var(--green);">
        <div style="font-size:10px;font-weight:700;color:var(--green);margin-bottom:6px;">ğŸ“ˆ íˆ¬ì ë…¼ë¦¬</div>
        <div style="font-size:12px;line-height:1.7;">${s.reason}</div>
      </div>
      <div style="padding:14px;background:var(--red-dim);border-radius:10px;border-left:3px solid var(--red);">
        <div style="font-size:10px;font-weight:700;color:var(--red);margin-bottom:6px;">âš ï¸ ë°˜ë¡ </div>
        <div style="font-size:12px;line-height:1.7;">${s.counter}</div>
      </div>
    </div>`;
  setTimeout(()=>{
    if(usPrice) usPrice.destroy();
    usPrice = new Chart(document.getElementById("usPriceC"),{type:"line",data:{labels:["7ì¼ì „","6ì¼ì „","5ì¼ì „","4ì¼ì „","3ì¼ì „","2ì¼ì „","ì˜¤ëŠ˜"],datasets:[{data:s.history,fill:true,borderColor:"#22c55e",backgroundColor:"rgba(34,197,94,0.1)",tension:0.4,pointRadius:3,pointBackgroundColor:"#22c55e",borderWidth:2}]},options:{responsive:true,maintainAspectRatio:false,plugins:{legend:{display:false}},scales:{x:{grid:{color:"#1e2030"},ticks:{color:"#4a4d6a",font:{size:9}}},y:{grid:{color:"#1e2030"},ticks:{color:"#4a4d6a",font:{size:9}}}}}});
    if(usRadar) usRadar.destroy();
    usRadar = new Chart(document.getElementById("usRadarC"),{type:"radar",data:{labels:["í€„ë¦¬í‹°","ë””ìŠ¤ì¹´ìš´íŠ¸","ê°€ê²©","ë§¤í¬ë¡œ","íƒ€ì´ë°"],datasets:[{data:s.radarData,fill:true,borderColor:"#22c55e",backgroundColor:"rgba(34,197,94,0.15)",pointBackgroundColor:"#22c55e",borderWidth:2}]},options:{responsive:true,maintainAspectRatio:false,plugins:{legend:{display:false}},scales:{r:{min:0,max:100,grid:{color:"#1e2030"},ticks:{display:false},pointLabels:{color:"#6b7094",font:{size:10}}}}}});
  },50);
  panel.scrollIntoView({behavior:"smooth",block:"start"});
}

// â”€â”€ ì±„ê¶Œ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderBonds() {
  const bonds=[
    {name:"ë¯¸êµ­ 10Y êµ­ì±„",yield:"4.52%",change:"+0.03",up:true,signal:"ê¸ˆë¦¬ ìƒìŠ¹ ì‚¬ì´í´ â€” ì‹ ê·œ ì£¼ì‹ ì§„ì… ì‹ ì¤‘"},
    {name:"í•œêµ­ 3Y êµ­ì±„",yield:"3.28%",change:"-0.02",up:false,signal:"ì•ˆì •ì  â€” í˜„ ìˆ˜ì¤€ ìœ ì§€"},
    {name:"ë¯¸êµ­ 2Y-10Y ìŠ¤í”„ë ˆë“œ",yield:"0.15%",change:"+0.05",up:true,signal:"ì •ìƒí™” ì§„í–‰ ì¤‘ â€” ê²½ê¸°ì¹¨ì²´ ë¦¬ìŠ¤í¬ ì™„í™”"},
  ];
  const comm=[
    {name:"ê¸ˆ",price:"$2,645",change:"+1.2%",up:true,signal:"ì•ˆì „ìì‚° ìˆ˜ìš” ìƒìŠ¹ â€” ê³µí¬ êµ¬ê°„ í™•ì¸"},
    {name:"WTI ì›ìœ ",price:"$71.3",change:"-0.8%",up:false,signal:"ê³µê¸‰ ê³¼ì‰ â€” ì—ë„ˆì§€ ì„¹í„° ì£¼ì˜"},
    {name:"êµ¬ë¦¬",price:"$9,120",change:"+0.5%",up:true,signal:"ê²½ê¸° íšŒë³µ ì‹ í˜¸ â€” ì‚°ì—…ì¬ ê´€ì‹¬"},
  ];
  document.getElementById("bondsBox").innerHTML = `
    <div style="display:flex;flex-direction:column;gap:8px;margin-bottom:16px;">
      ${bonds.map(b=>`<div class="card-sm" style="display:flex;justify-content:space-between;align-items:center;">
        <div><div style="font-size:13px;font-weight:600;">${b.name}</div><div style="font-size:11px;color:var(--muted);margin-top:2px;">${b.signal}</div></div>
        <div style="text-align:right;"><div style="font-size:20px;font-weight:700;">${b.yield}</div><div style="font-size:12px;color:${b.up?"var(--red)":"var(--green)"};">${b.change}</div></div>
      </div>`).join("")}
    </div>
    <div class="g3">
      ${comm.map(c=>`<div class="card">
        <div class="ct">${c.name}</div>
        <div style="font-size:22px;font-weight:700;">${c.price}</div>
        <div style="font-size:13px;font-weight:600;color:${c.up?"var(--green)":"var(--red)"};">${c.change}</div>
        <div style="font-size:11px;color:var(--dim);margin-top:6px;">${c.signal}</div>
      </div>`).join("")}
    </div>
    <div class="card" style="margin-top:16px;">
      <div class="ct">ë§¤í¬ë¡œ ì›ì¹™ â€” í•˜ì›Œë“œ ë§‰ìŠ¤</div>
      <div style="font-size:13px;line-height:1.8;color:var(--text);">ë¯¸êµ­ 10Y ê¸ˆë¦¬ <b style="color:var(--orange);">4.52%</b> ìƒìŠ¹ ì‚¬ì´í´ ì§€ì†. í•˜ì›Œë“œ ë§‰ìŠ¤ ì›ì¹™ì— ë”°ë¼ ì‹ ê·œ ì§„ì…ë³´ë‹¤ <b>ê¸°ì¡´ ë³´ìœ  ìœ ì§€</b>ì— ì§‘ì¤‘. í˜„ê¸ˆ ë¹„ì¤‘ <b style="color:var(--accent);">20%</b> ì´ìƒ ì‹¤íƒ„ ìœ ì§€ ê¶Œì¥. ê¸ˆë¦¬ ì¸í•˜ ì‚¬ì´í´ ì „í™˜ ì‹œ ì£¼ì‹ ë¹„ì¤‘ í™•ëŒ€ ê¸°íšŒ.</div>
    </div>`;
}

// â”€â”€ íˆ¬ì ì¼ì§€ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const JOURNAL=[
  {date:"2026-02-25",ticker:"005930",name:"ì‚¼ì„±ì „ì",action:"ë§¤ìˆ˜",reason:"ìì‚¬ì£¼ ë§¤ì… ê³µì‹œ + ROE 18% + PBR 1.1. ë³¼ë¦°ì € ë°´ë“œ í•˜ë‹¨ ì ‘ê·¼. Draft 3.0 5/5 í†µê³¼.",counter:"ë©”ëª¨ë¦¬ ì‚¬ì´í´ í”¼í¬ì•„ì›ƒ ê°€ëŠ¥ì„±. ì¤‘êµ­ CXMT ì¶”ê²©. HBM ì „í™˜ì´ ë¦¬ìŠ¤í¬ ì™„í™” ìš”ì¸.",target:"â‚©82,000",buyPct:8,successProb:78},
  {date:"2026-02-20",ticker:"MSFT",name:"Microsoft",action:"ë³´ìœ ìœ ì§€",reason:"ROIC 42%, Azure AI ì„±ì¥ ì§€ì†. PEG 1.8. Draft 3.0 5/5 í†µê³¼.",counter:"Valuation ë¶€ë‹´. OpenAI ì˜ì¡´ë„. DOJ ë°˜ë…ì  ë¦¬ìŠ¤í¬.",target:"$480",buyPct:10,successProb:82},
];

function renderJournal() {
  document.getElementById("journalBox").innerHTML = JOURNAL.map(j=>`
    <div class="journal-card" style="margin-bottom:14px;">
      <div style="display:flex;align-items:center;gap:10px;margin-bottom:14px;">
        <span class="badge ${j.action==="ë§¤ìˆ˜"?"bg":"bb"}">${j.action}</span>
        <span style="font-size:15px;font-weight:700;">${j.name}</span>
        <span style="font-size:11px;color:var(--muted);">${j.ticker}</span>
        <span style="font-size:11px;color:var(--muted);margin-left:auto;">${j.date}</span>
      </div>
      <div class="g2" style="margin-bottom:12px;">
        <div class="card-sm">
          <div style="font-size:9px;color:var(--muted);margin-bottom:4px;">ê¶Œì¥ ë¹„ì¤‘</div>
          <div style="font-size:22px;font-weight:800;color:var(--accent);">${j.buyPct}%</div>
        </div>
        <div class="card-sm">
          <div style="font-size:9px;color:var(--muted);margin-bottom:4px;">ì„±ê³µí™•ë¥ </div>
          <div style="font-size:22px;font-weight:800;color:${j.successProb>=70?"var(--green)":"var(--orange)"};">${j.successProb}%</div>
        </div>
      </div>
      <div class="g2" style="margin-bottom:12px;">
        <div style="padding:12px;background:var(--green-dim);border-radius:8px;border-left:3px solid var(--green);">
          <div style="font-size:10px;font-weight:700;color:var(--green);margin-bottom:5px;">íˆ¬ì ë…¼ë¦¬</div>
          <div style="font-size:12px;line-height:1.6;">${j.reason}</div>
        </div>
        <div style="padding:12px;background:var(--red-dim);border-radius:8px;border-left:3px solid var(--red);">
          <div style="font-size:10px;font-weight:700;color:var(--red);margin-bottom:5px;">ë°˜ë¡ </div>
          <div style="font-size:12px;line-height:1.6;">${j.counter}</div>
        </div>
      </div>
      <div style="font-size:12px;"><span style="color:var(--muted);">ëª©í‘œê°€: </span><span style="color:var(--accent);font-weight:700;">${j.target}</span></div>
    </div>`).join("");
}

// â”€â”€ AI ì±„íŒ… â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function sendChat() {
  if(chatBusy) return;
  const inp = document.getElementById("chatIn");
  const msg = inp.value.trim(); if(!msg) return;
  inp.value=""; addMsg(msg,"u"); chatBusy=true;
  const loading = addMsg("ë¶„ì„ ì¤‘...","a");

  let dartCtx="";
  try {
    const r = await fetch(`${BACKEND}/dart/recent?days=7`);
    const j = await r.json();
    dartCtx = (j.data||[]).slice(0,5).map(d=>`${d.company}: ${d.title} (${d.date})`).join("\n");
  } catch {}

  const sys = `ë‹¹ì‹ ì€ Andrewì˜ íˆ¬ì ë¶„ì„ AIì…ë‹ˆë‹¤. Draft 3.0 ì² í•™(ë²„í• ê°€ì¹˜íˆ¬ì+í•˜ì›Œë“œ ë§‰ìŠ¤ ì‚¬ì´í´+ì¹´ë„ˆë¨¼ í–‰ë™ê²½ì œí•™) ê¸°ë°˜ìœ¼ë¡œ ë¶„ì„í•©ë‹ˆë‹¤.

ì˜¤ëŠ˜ DART ê³µì‹œ:
${dartCtx||"ì—†ìŒ"}

êµ­ì¥ ë¶„ì„ ëŒ€ìƒ: ì‚¼ì„±ì „ì(92ì ,ë§¤ìˆ˜8%,ì„±ê³µ78%), SKí•˜ì´ë‹‰ìŠ¤(88ì ,ë§¤ìˆ˜7%,ì„±ê³µ74%), ì‚¼ì„±SDI(85ì ,ë§¤ìˆ˜5%,ì„±ê³µ68%)
ë¯¸ì¥ ë¶„ì„ ëŒ€ìƒ: MSFT(94ì ,ë§¤ìˆ˜10%,ì„±ê³µ82%), GOOGL(91ì ,ë§¤ìˆ˜9%,ì„±ê³µ80%), AAPL(90ì ,ë§¤ìˆ˜8%,ì„±ê³µ76%)

ë‹µë³€ í˜•ì‹:
â–  ìš”ì•½
â–  Draft 3.0 ì²´í¬ (í€„ë¦¬í‹°/ë””ìŠ¤ì¹´ìš´íŠ¸/ê°€ê²©/ë§¤í¬ë¡œ/íƒ€ì´ë°)
â–  íˆ¬ì ë…¼ë¦¬
â–  ë°˜ë¡  (ì™œ í‹€ë¦´ ìˆ˜ ìˆë‚˜)
â–  ê²°ë¡  ë° ê¶Œì¥ ë¹„ì¤‘

í•œêµ­ì–´, ê°„ê²°í•˜ê²Œ.`;

  try {
    const r = await fetch("https://api.anthropic.com/v1/messages",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({model:"claude-sonnet-4-20250514",max_tokens:1000,system:sys,messages:[{role:"user",content:msg}]})});
    const d = await r.json();
    loading.textContent = d.content?.[0]?.text||"ì‘ë‹µ ì˜¤ë¥˜";
  } catch {
    loading.textContent = "AI ì‘ë‹µ ì˜¤ë¥˜ â€” ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.";
  }
  chatBusy=false;
}

function addMsg(text, role) {
  const d = document.createElement("div");
  d.className = `msg msg-${role}`;
  d.textContent = text;
  const c = document.getElementById("chat-msgs");
  c.appendChild(d);
  c.scrollTop = c.scrollHeight;
  return d;
}

// â”€â”€ ì´ˆê¸°í™” â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
fetchDart();
</script>
</body>
</html>