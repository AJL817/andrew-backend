<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Andrew Investment System</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.1/chart.umd.min.js"></script>
<style>
* { margin:0; padding:0; box-sizing:border-box; }
:root {
  --bg:#0a0b0f; --surface:#12131a; --surface2:#1a1b24;
  --border:#1e2030; --text:#e8e9f0; --dim:#6b7094; --muted:#4a4d6a;
  --accent:#c9a55a; --accent-dim:rgba(201,165,90,0.15);
  --green:#22c55e; --green-dim:rgba(34,197,94,0.12);
  --red:#ef4444; --red-dim:rgba(239,68,68,0.12);
  --blue:#3b82f6; --blue-dim:rgba(59,130,246,0.12);
  --orange:#f59e0b; --orange-dim:rgba(245,158,11,0.12);
  --purple:#8b5cf6; --purple-dim:rgba(139,92,246,0.12);
}
body { background:var(--bg); color:var(--text); font-family:-apple-system,sans-serif; display:flex; min-height:100vh; }
#sidebar { width:220px; min-height:100vh; background:var(--surface); border-right:1px solid var(--border); padding:20px 12px; display:flex; flex-direction:column; position:fixed; top:0; left:0; z-index:100; }
.logo h1 { font-size:22px; font-weight:800; color:var(--accent); }
.logo p { font-size:8px; color:var(--muted); letter-spacing:3px; margin-top:2px; }
.status { display:flex; align-items:center; gap:6px; margin-top:8px; }
.dot { width:6px; height:6px; border-radius:50%; background:var(--orange); }
.dot.on { background:var(--green); box-shadow:0 0 8px rgba(34,197,94,0.5); }
.dot.off { background:var(--red); }
nav { display:flex; flex-direction:column; gap:3px; flex:1; margin-top:24px; }
.nb { display:flex; align-items:center; gap:10px; padding:10px 12px; border-radius:8px; border:none; cursor:pointer; font-size:13px; font-family:inherit; text-align:left; background:transparent; color:var(--dim); width:100%; }
.nb.active, .nb:hover { background:var(--accent-dim); color:var(--accent); font-weight:600; }
.sf { padding:12px 8px; border-top:1px solid var(--border); margin-top:auto; font-size:10px; color:var(--muted); line-height:1.6; }
#main { flex:1; margin-left:220px; }
#topbar { height:52px; border-bottom:1px solid var(--border); display:flex; align-items:center; justify-content:space-between; padding:0 24px; position:sticky; top:0; background:var(--bg); z-index:50; }
#content { padding:24px; }
.tp { display:none; flex-direction:column; gap:20px; }
.tp.active { display:flex; }
.card { background:var(--surface); border:1px solid var(--border); border-radius:12px; padding:18px; }
.card-sm { background:var(--surface); border:1px solid var(--border); border-radius:10px; padding:14px 16px; }
.ct { font-size:11px; color:var(--muted); margin-bottom:10px; letter-spacing:0.5px; }
.badge { display:inline-flex; align-items:center; padding:3px 9px; border-radius:5px; font-size:10px; font-weight:700; }
.bh { color:var(--red); background:var(--red-dim); }
.bm { color:var(--orange); background:var(--orange-dim); }
.bn { color:var(--muted); background:var(--surface2); }
.bb { color:var(--blue); background:var(--blue-dim); }
.ba { color:var(--accent); background:var(--accent-dim); }
.bg { color:var(--green); background:var(--green-dim); }
.bp { color:var(--purple); background:var(--purple-dim); }
.btn { padding:7px 14px; border-radius:8px; border:none; cursor:pointer; font-size:12px; font-weight:600; font-family:inherit; background:var(--surface2); color:var(--dim); }
.btn-a { background:var(--accent); color:var(--bg); }
select { background:var(--surface); border:1px solid var(--border); color:var(--text); border-radius:8px; padding:7px 12px; font-size:12px; font-family:inherit; cursor:pointer; outline:none; }
.filter-btn { padding:5px 14px; border-radius:20px; border:1px solid var(--border); cursor:pointer; font-size:12px; font-weight:600; font-family:inherit; background:var(--surface); color:var(--dim); }
.filter-btn.active { background:var(--accent-dim); color:var(--accent); border-color:var(--accent); }
.di { background:var(--surface); border:1px solid var(--border); border-radius:8px; padding:13px 16px; display:flex; align-items:center; gap:10px; cursor:pointer; text-decoration:none; }
.di:hover { border-color:var(--accent); }
.sb-wrap { display:flex; align-items:center; gap:8px; }
.sb-track { flex:1; height:5px; background:var(--border); border-radius:3px; overflow:hidden; }
.sb-fill { height:100%; border-radius:3px; }
.sb-num { font-size:12px; font-weight:700; min-width:28px; text-align:right; }
.stock-card { background:var(--surface); border:1px solid var(--border); border-radius:12px; padding:18px; cursor:pointer; }
.stock-card:hover, .stock-card.sel { border-color:var(--accent); background:var(--surface2); }
.stock-grid { display:grid; grid-template-columns:repeat(3,1fr); gap:12px; }
.match-bar { height:8px; background:var(--border); border-radius:4px; overflow:hidden; margin:6px 0; }
.match-fill { height:100%; border-radius:4px; background:linear-gradient(90deg,var(--green),var(--accent)); }
.check-item { display:flex; align-items:flex-start; gap:8px; padding:8px 10px; border-radius:8px; }
.ci-pass { background:var(--green-dim); }
.ci-fail { background:var(--red-dim); }
.prob-bar { height:12px; background:var(--border); border-radius:6px; overflow:hidden; margin-top:6px; }
.prob-fill { height:100%; border-radius:6px; }
.g2 { display:grid; grid-template-columns:1fr 1fr; gap:16px; }
.g3 { display:grid; grid-template-columns:repeat(3,1fr); gap:12px; }
.g4 { display:grid; grid-template-columns:repeat(4,1fr); gap:12px; }
.spin-wrap { display:flex; align-items:center; gap:8px; color:var(--muted); font-size:13px; padding:30px 20px; }
.spin { width:16px; height:16px; border:2px solid var(--border); border-top:2px solid var(--accent); border-radius:50%; animation:spin 0.8s linear infinite; }
@keyframes spin { to { transform:rotate(360deg); } }
.err { background:var(--red-dim); border:1px solid rgba(239,68,68,0.3); border-radius:10px; padding:14px; }
#chat-msgs { max-height:420px; overflow-y:auto; display:flex; flex-direction:column; gap:10px; padding:4px; margin-bottom:14px; }
.msg { padding:12px 16px; border-radius:14px; font-size:13px; line-height:1.7; white-space:pre-wrap; max-width:85%; }
.msg-u { align-self:flex-end; background:var(--accent); color:var(--bg); border-radius:14px 14px 4px 14px; }
.msg-a { align-self:flex-start; background:var(--surface2); border:1px solid var(--border); border-radius:14px 14px 14px 4px; }
.msg-s { background:var(--surface2); font-size:11px; color:var(--dim); max-width:100%; border-radius:8px; }
.ci { display:flex; gap:8px; padding:12px 16px; background:var(--surface); border-radius:12px; border:1px solid var(--border); }
.ci input { flex:1; background:transparent; border:none; outline:none; color:var(--text); font-size:13px; font-family:inherit; }
.step-item { display:flex; gap:12px; align-items:flex-start; padding:12px 14px; background:var(--surface); border:1px solid var(--border); border-radius:10px; }
.step-num { min-width:28px; height:28px; border-radius:8px; display:flex; align-items:center; justify-content:center; font-size:13px; font-weight:800; flex-shrink:0; }
.no-item { padding:12px 14px; border-radius:10px; }
.quote-item { padding:12px 16px; background:var(--surface2); border-radius:8px; border-left:3px solid var(--accent); }
.bias-item { display:flex; align-items:flex-start; gap:12px; padding:12px 14px; background:var(--surface); border:1px solid var(--border); border-radius:10px; }
</style>
</head>
<body>
<div id="sidebar">
  <div class="logo">
    <h1>ANDREW</h1>
    <p>INVESTMENT SYSTEM v2</p>
    <div class="status">
      <div class="dot" id="dot"></div>
      <span style="font-size:10px;color:var(--muted)" id="stxt">í™•ì¸ì¤‘...</span>
    </div>
  </div>
  <nav>
    <button class="nb active" onclick="go('dash')" id="nav-dash"><span style="width:20px;text-align:center">â—‰</span>ëŒ€ì‹œë³´ë“œ</button>
    <button class="nb" onclick="go('kr')" id="nav-kr"><span style="width:20px;text-align:center">ğŸ‡°ğŸ‡·</span>êµ­ì¥ ë¶„ì„</button>
    <button class="nb" onclick="go('us')" id="nav-us"><span style="width:20px;text-align:center">ğŸ‡ºğŸ‡¸</span>ë¯¸ì¥ ë¶„ì„</button>
    <button class="nb" onclick="go('bonds')" id="nav-bonds"><span style="width:20px;text-align:center">â—†</span>ì±„ê¶ŒÂ·ì›ìì¬</button>
    <button class="nb" onclick="go('journal')" id="nav-journal"><span style="width:20px;text-align:center">âœ</span>íˆ¬ì ì¼ì§€</button>
    <button class="nb" onclick="go('phil')" id="nav-phil"><span style="width:20px;text-align:center">ğŸ“–</span>íˆ¬ì ì² í•™</button>
    <button class="nb" onclick="go('ai')" id="nav-ai"><span style="width:20px;text-align:center">â¬¡</span>AI ë¶„ì„</button>
  </nav>
  <div class="sf">Draft 3.0 íˆ¬ì ì² í•™<br>DART ì‹¤ì‹œê°„ Â· KIS Â· AlphaVantage</div>
</div>

<div id="main">
  <div id="topbar">
    <span id="dateStr" style="font-size:12px;color:var(--dim)"></span>
    <span id="timeStr" style="font-size:12px;color:var(--muted)"></span>
  </div>
  <div id="content">

    <!-- ëŒ€ì‹œë³´ë“œ -->
    <div class="tp active" id="tab-dash">
      <div style="display:flex;align-items:center;justify-content:space-between">
        <div>
          <div style="font-size:17px;font-weight:700">ğŸ“‹ DART ì „ìê³µì‹œ ì‹¤ì‹œê°„</div>
          <div style="font-size:11px;color:var(--muted);margin-top:3px" id="lastUpd">ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
        </div>
        <div style="display:flex;gap:8px">
          <select id="daysSel" onchange="fetchDart()">
            <option value="3">ìµœê·¼ 3ì¼</option>
            <option value="7" selected>ìµœê·¼ 7ì¼</option>
            <option value="14">ìµœê·¼ 14ì¼</option>
            <option value="30">ìµœê·¼ 30ì¼</option>
          </select>
          <button class="btn btn-a" onclick="fetchDart()">ğŸ”„ ìƒˆë¡œê³ ì¹¨</button>
        </div>
      </div>
      <div class="g4">
        <div class="card-sm"><div class="ct">KOSPI</div><div style="font-size:20px;font-weight:700">2,634</div><div style="color:var(--green);font-size:12px;font-weight:600">+1.2%</div></div>
        <div class="card-sm"><div class="ct">S&P 500</div><div style="font-size:20px;font-weight:700">6,012</div><div style="color:var(--red);font-size:12px;font-weight:600">-0.3%</div></div>
        <div class="card-sm"><div class="ct">ì›/ë‹¬ëŸ¬</div><div style="font-size:20px;font-weight:700">1,342</div><div style="color:var(--green);font-size:12px;font-weight:600">+0.1%</div></div>
        <div class="card-sm"><div class="ct">VIX</div><div style="font-size:20px;font-weight:700">14.2</div><div style="color:var(--orange);font-size:12px">ë‚®ìŒ â†’ ê²½ê³„</div></div>
      </div>
      <div style="display:flex;gap:8px;flex-wrap:wrap" id="cFilters"></div>
      <div id="dartBox"></div>
      <div class="g2">
        <div class="card">
          <div class="ct">ê³µí¬ & íƒìš• ì§€ìˆ˜</div>
          <canvas id="gaugeC" width="220" height="120"></canvas>
          <p style="font-size:11px;color:var(--dim);text-align:center;margin-top:6px;font-style:italic">"ì§€ê¸ˆì€ ê³µí¬ êµ¬ê°„ â€” í•˜ì›Œë“œ ë§‰ìŠ¤ ë§¤ìˆ˜ ì‹ í˜¸"</p>
        </div>
        <div class="card">
          <div class="ct">í¬íŠ¸í´ë¦¬ì˜¤ í˜„í™©</div>
          <canvas id="portC" height="140"></canvas>
        </div>
      </div>
    </div>

    <!-- êµ­ì¥ -->
    <div class="tp" id="tab-kr">
      <div>
        <div style="font-size:17px;font-weight:700">ğŸ‡°ğŸ‡· êµ­ì¥ ìŠ¤í¬ë¦¬ë„ˆ â€” Draft 3.0</div>
        <div style="font-size:11px;color:var(--muted);margin-top:3px">ROE â‰¥ 15% Â· PBR ì—…ì¢… ì´í•˜ Â· í•´ì Â· ì½”ë¦¬ì•„ ë””ìŠ¤ì¹´ìš´íŠ¸ í•„í„° Â· BB íƒ€ì´ë°</div>
      </div>
      <div class="stock-grid" id="krCards"></div>
      <div id="kr-detail" style="display:none" class="card"><div id="kr-detail-content"></div></div>
    </div>

    <!-- ë¯¸ì¥ -->
    <div class="tp" id="tab-us">
      <div>
        <div style="font-size:17px;font-weight:700">ğŸ‡ºğŸ‡¸ ë¯¸ì¥ ìŠ¤í¬ë¦¬ë„ˆ â€” ìš°ëŸ‰ ì„±ì¥ì£¼</div>
        <div style="font-size:11px;color:var(--muted);margin-top:3px">ROIC > WACC Â· PEG Â· í•´ì ê°•ë„ Â· 10ë…„ ì„±ì¥ êµ¬ì¡° Â· í™˜ìœ¨ ì¸ì‹</div>
      </div>
      <div class="stock-grid" id="usCards"></div>
      <div id="us-detail" style="display:none" class="card"><div id="us-detail-content"></div></div>
    </div>

    <!-- ì±„ê¶Œ -->
    <div class="tp" id="tab-bonds">
      <div style="font-size:17px;font-weight:700;margin-bottom:4px">â—† ì±„ê¶Œ Â· ì›ìì¬ â€” ë§¤í¬ë¡œ ì‚¬ì´í´</div>
      <div id="bondsBox"></div>
    </div>

    <!-- íˆ¬ì ì¼ì§€ -->
    <div class="tp" id="tab-journal">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <div style="font-size:17px;font-weight:700">âœ íˆ¬ì ì¼ì§€</div>
        <button class="btn btn-a">+ ìƒˆ ê¸°ë¡</button>
      </div>
      <div id="journalBox"></div>
    </div>

    <!-- íˆ¬ì ì² í•™ -->
    <div class="tp" id="tab-phil">
      <div>
        <div style="font-size:17px;font-weight:700">ğŸ“– Draft 3.0 íˆ¬ì ì² í•™</div>
        <div style="font-size:11px;color:var(--muted);margin-top:3px">ë²„í• ê°€ì¹˜íˆ¬ì Ã— í•˜ì›Œë“œ ë§‰ìŠ¤ ì‚¬ì´í´ Ã— ì¹´ë„ˆë¨¼ í–‰ë™ê²½ì œí•™</div>
      </div>

      <!-- 3ëŒ€ ì² í•™ -->
      <div class="g3">
        <div class="card" style="border-left:3px solid var(--accent)">
          <div style="font-size:24px;margin-bottom:8px">ğŸ°</div>
          <div style="font-size:13px;font-weight:700;color:var(--accent);margin-bottom:6px">ì›ŒëŸ° ë²„í•</div>
          <div style="font-size:12px;color:var(--dim);line-height:1.7">ì¢‹ì€ ê¸°ì—…ì„ ì ì •ê°€ì—. ROEÂ·í•´ìÂ·ì¥ê¸°ë³´ìœ . ì´í•´í•˜ì§€ ëª»í•˜ëŠ” ê¸°ì—…ì€ íˆ¬ìí•˜ì§€ ì•ŠëŠ”ë‹¤.</div>
        </div>
        <div class="card" style="border-left:3px solid var(--blue)">
          <div style="font-size:24px;margin-bottom:8px">ğŸŒŠ</div>
          <div style="font-size:13px;font-weight:700;color:var(--blue);margin-bottom:6px">í•˜ì›Œë“œ ë§‰ìŠ¤</div>
          <div style="font-size:12px;color:var(--dim);line-height:1.7">ì‚¬ì´í´ì„ ì¸ì‹í•˜ë¼. ê³µí¬ì¼ ë•Œ ì‚¬ê³  íƒìš•ì¼ ë•Œ íŒ”ì•„ë¼. ë¦¬ìŠ¤í¬ëŠ” ìˆ˜ìµë¥ ì´ ì•„ë‹ˆë¼ ì†ì‹¤ ê°€ëŠ¥ì„±ì´ë‹¤.</div>
        </div>
        <div class="card" style="border-left:3px solid var(--purple)">
          <div style="font-size:24px;margin-bottom:8px">ğŸ§ </div>
          <div style="font-size:13px;font-weight:700;color:var(--purple);margin-bottom:6px">ë‹¤ë‹ˆì—˜ ì¹´ë„ˆë¨¼</div>
          <div style="font-size:12px;color:var(--dim);line-height:1.7">ë‚´ íŒë‹¨ì€ í•­ìƒ í¸í–¥ë˜ì–´ ìˆë‹¤. ë§¤ìˆ˜ ì „ ë°˜ë“œì‹œ ë°˜ë¡ ì„ ë¨¼ì € ì¨ë¼. ì‹œìŠ¤í…œ 2ë¡œ ê²°ì •í•˜ë¼.</div>
        </div>
      </div>

      <!-- êµ­ì¥ vs ë¯¸ì¥ ê¸°ì¤€ -->
      <div>
        <div style="font-size:14px;font-weight:700;margin-bottom:12px">ğŸ‡°ğŸ‡· êµ­ì¥ vs ğŸ‡ºğŸ‡¸ ë¯¸ì¥ â€” íˆ¬ì ê¸°ì¤€</div>
        <div class="g2">
          <div class="card">
            <div style="font-size:13px;font-weight:700;color:var(--blue);margin-bottom:14px">ğŸ‡°ğŸ‡· êµ­ì¥ 5ë‹¨ê³„ ê¸°ì¤€</div>
            <div style="display:flex;flex-direction:column;gap:10px">
              <div style="display:flex;gap:10px">
                <span style="min-width:22px;height:22px;background:var(--blue-dim);color:var(--blue);border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:11px;font-weight:700;flex-shrink:0">1</span>
                <div><div style="font-size:12px;font-weight:600">ê¸°ì—… í€„ë¦¬í‹°</div><div style="font-size:11px;color:var(--dim);margin-top:2px;line-height:1.5">ROE â‰¥ 15%, ëª…í™•í•œ í•´ì(ì›ê°€ìš°ìœ„Â·ì „í™˜ë¹„ìš©Â·ë„¤íŠ¸ì›Œí¬), ë¶€ì±„ë¹„ìœ¨ 60% ì´í•˜</div></div>
              </div>
              <div style="display:flex;gap:10px">
                <span style="min-width:22px;height:22px;background:var(--blue-dim);color:var(--blue);border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:11px;font-weight:700;flex-shrink:0">2</span>
                <div><div style="font-size:12px;font-weight:600">ì½”ë¦¬ì•„ ë””ìŠ¤ì¹´ìš´íŠ¸ í•„í„°</div><div style="font-size:11px;color:var(--dim);margin-top:2px;line-height:1.5">â‘  ì¼ì‹œì  ì•…ì¬(ë§¤ìˆ˜ ëŒ€ìƒ) â‘¡ êµ¬ì¡°ì  ë¬¸ì œ(ì œì™¸) â‘¢ ì§€ë°°êµ¬ì¡° ë¬¸ì œ(ì œì™¸)</div></div>
              </div>
              <div style="display:flex;gap:10px">
                <span style="min-width:22px;height:22px;background:var(--blue-dim);color:var(--blue);border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:11px;font-weight:700;flex-shrink:0">3</span>
                <div><div style="font-size:12px;font-weight:600">ê°€ê²© í•„í„°</div><div style="font-size:11px;color:var(--dim);margin-top:2px;line-height:1.5">PBR ì—…ì¢… í‰ê·  ì´í•˜, EV/EBIT 10x ì´í•˜, ì—­ì‚¬ì  ì €ì  ê·¼ì²˜</div></div>
              </div>
              <div style="display:flex;gap:10px">
                <span style="min-width:22px;height:22px;background:var(--blue-dim);color:var(--blue);border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:11px;font-weight:700;flex-shrink:0">4</span>
                <div><div style="font-size:12px;font-weight:600">ë§¤í¬ë¡œ ì¸ì‹</div><div style="font-size:11px;color:var(--dim);margin-top:2px;line-height:1.5">ê¸ˆë¦¬ ì‚¬ì´í´ í™•ì¸, ê³µí¬Â·íƒìš• ì§€ìˆ˜ 30 ì´í•˜ì—ì„œ ì§‘ì¤‘ ë§¤ìˆ˜</div></div>
              </div>
              <div style="display:flex;gap:10px">
                <span style="min-width:22px;height:22px;background:var(--blue-dim);color:var(--blue);border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:11px;font-weight:700;flex-shrink:0">5</span>
                <div><div style="font-size:12px;font-weight:600">ë³¼ë¦°ì € ë°´ë“œ íƒ€ì´ë°</div><div style="font-size:11px;color:var(--dim);margin-top:2px;line-height:1.5">BB í•˜ë‹¨ ì ‘ê·¼ or Squeeze í›„ ë°©í–¥ í™•ì¸ ì‹œ ì§„ì…. ìƒë‹¨ ì ‘ê·¼ ì‹œ ë¹„ì¤‘ ì¶•ì†Œ</div></div>
              </div>
            </div>
          </div>
          <div class="card">
            <div style="font-size:13px;font-weight:700;color:var(--green);margin-bottom:14px">ğŸ‡ºğŸ‡¸ ë¯¸ì¥ 5ë‹¨ê³„ ê¸°ì¤€</div>
            <div style="display:flex;flex-direction:column;gap:10px">
              <div style="display:flex;gap:10px">
                <span style="min-width:22px;height:22px;background:var(--green-dim);color:var(--green);border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:11px;font-weight:700;flex-shrink:0">1</span>
                <div><div style="font-size:12px;font-weight:600">ROIC > WACC</div><div style="font-size:11px;color:var(--dim);margin-top:2px;line-height:1.5">ROIC 30% ì´ìƒ. ìë³¸ì„ íš¨ìœ¨ì ìœ¼ë¡œ ì‚¬ìš©í•´ ì§€ì†ì  ì´ˆê³¼ìˆ˜ìµ ì°½ì¶œ</div></div>
              </div>
              <div style="display:flex;gap:10px">
                <span style="min-width:22px;height:22px;background:var(--green-dim);color:var(--green);border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:11px;font-weight:700;flex-shrink:0">2</span>
                <div><div style="font-size:12px;font-weight:600">í•´ì ê°•ë„</div><div style="font-size:11px;color:var(--dim);margin-top:2px;line-height:1.5">ë¸Œëœë“œÂ·ë„¤íŠ¸ì›Œí¬Â·ì „í™˜ë¹„ìš©Â·ì›ê°€ìš°ìœ„ ì¤‘ 2ê°œ ì´ìƒ. 10ë…„ í›„ì—ë„ ìœ ì§€ ê°€ëŠ¥í•œê°€</div></div>
              </div>
              <div style="display:flex;gap:10px">
                <span style="min-width:22px;height:22px;background:var(--green-dim);color:var(--green);border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:11px;font-weight:700;flex-shrink:0">3</span>
                <div><div style="font-size:12px;font-weight:600">PEG & ì„±ì¥</div><div style="font-size:11px;color:var(--dim);margin-top:2px;line-height:1.5">PEG â‰¤ 2.0. ì„±ì¥ë¥  ëŒ€ë¹„ ë°¸ë¥˜ì—ì´ì…˜ í•©ë¦¬ì . ì¥ê¸° ì„±ì¥ êµ¬ì¡°(10ë…„ í…Œë§ˆ) í™•ì¸</div></div>
              </div>
              <div style="display:flex;gap:10px">
                <span style="min-width:22px;height:22px;background:var(--green-dim);color:var(--green);border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:11px;font-weight:700;flex-shrink:0">4</span>
                <div><div style="font-size:12px;font-weight:600">í™˜ìœ¨ ì›ì¹™</div><div style="font-size:11px;color:var(--dim);margin-top:2px;line-height:1.5">ì›/ë‹¬ëŸ¬ ë†’ì„ ë•Œ(1,300â†‘) í™˜ì „ ì¶•ì†Œ. ë‚®ì„ ë•Œ(1,200â†“) í™˜ì „ í™•ëŒ€. í™˜ìœ¨ë„ ìˆ˜ìµë¥ </div></div>
              </div>
              <div style="display:flex;gap:10px">
                <span style="min-width:22px;height:22px;background:var(--green-dim);color:var(--green);border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:11px;font-weight:700;flex-shrink:0">5</span>
                <div><div style="font-size:12px;font-weight:600">ë¶„ì‚° & ë³´ìœ ê¸°ê°„</div><div style="font-size:11px;color:var(--dim);margin-top:2px;line-height:1.5">ê°œë³„ ì¢…ëª© ìµœëŒ€ 15%. ìµœì†Œ 3~5ë…„ ë³´ìœ  ì „ì œ. ë‹¨ê¸° ë³€ë™ì„±ì— íŒ”ì§€ ì•ŠëŠ”ë‹¤</div></div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- 8ë‹¨ê³„ ì˜ì‚¬ê²°ì • -->
      <div>
        <div style="font-size:14px;font-weight:700;margin-bottom:12px">âš™ï¸ ë§¤ìˆ˜ ì „ 8ë‹¨ê³„ ì˜ì‚¬ê²°ì • í”„ë ˆì„ì›Œí¬</div>
        <div style="display:flex;flex-direction:column;gap:8px">
          <div class="step-item"><div class="step-num" style="background:var(--accent-dim);color:var(--accent)">1</div><div><div style="font-size:12px;font-weight:700;color:var(--accent)">1ë‹¨ê³„ â€” ê¸°ì—… ì´í•´</div><div style="font-size:12px;color:var(--dim);margin-top:2px;line-height:1.5">ì´ ê¸°ì—…ì´ ì–´ë–»ê²Œ ëˆì„ ë²„ëŠ”ì§€ 10ì´ˆ ì•ˆì— ì„¤ëª…í•  ìˆ˜ ìˆëŠ”ê°€?</div></div></div>
          <div class="step-item"><div class="step-num" style="background:var(--accent-dim);color:var(--accent)">2</div><div><div style="font-size:12px;font-weight:700;color:var(--accent)">2ë‹¨ê³„ â€” í•´ì í™•ì¸</div><div style="font-size:12px;color:var(--dim);margin-top:2px;line-height:1.5">5ë…„ í›„ì—ë„ ì´ ê²½ìŸìš°ìœ„ê°€ ìœ ì§€ë  ê²ƒì¸ê°€? ìœ„í˜‘ ìš”ì¸ì€ ë¬´ì—‡ì¸ê°€?</div></div></div>
          <div class="step-item"><div class="step-num" style="background:var(--blue-dim);color:var(--blue)">3</div><div><div style="font-size:12px;font-weight:700;color:var(--blue)">3ë‹¨ê³„ â€” ì¬ë¬´ í€„ë¦¬í‹°</div><div style="font-size:12px;color:var(--dim);margin-top:2px;line-height:1.5">ROE(êµ­ì¥ â‰¥15%) / ROIC(ë¯¸ì¥ â‰¥30%) ê¸°ì¤€ ì¶©ì¡±? ë¶€ì±„ëŠ” ê°ë‹¹ ê°€ëŠ¥í•œê°€?</div></div></div>
          <div class="step-item"><div class="step-num" style="background:var(--blue-dim);color:var(--blue)">4</div><div><div style="font-size:12px;font-weight:700;color:var(--blue)">4ë‹¨ê³„ â€” ì €í‰ê°€ ì›ì¸</div><div style="font-size:12px;color:var(--dim);margin-top:2px;line-height:1.5">ì™œ ì§€ê¸ˆ ì €í‰ê°€ì¸ê°€? ì¼ì‹œì  ì•…ì¬ì¸ê°€, êµ¬ì¡°ì  ë¬¸ì œì¸ê°€?</div></div></div>
          <div class="step-item"><div class="step-num" style="background:var(--green-dim);color:var(--green)">5</div><div><div style="font-size:12px;font-weight:700;color:var(--green)">5ë‹¨ê³„ â€” ì•ˆì „ë§ˆì§„</div><div style="font-size:12px;color:var(--dim);margin-top:2px;line-height:1.5">í˜„ì¬ ê°€ê²©ì—ì„œ ì¶©ë¶„í•œ ì•ˆì „ë§ˆì§„ì´ ìˆëŠ”ê°€? (ìµœì†Œ 20~30% ì—…ì‚¬ì´ë“œ)</div></div></div>
          <div class="step-item"><div class="step-num" style="background:var(--green-dim);color:var(--green)">6</div><div><div style="font-size:12px;font-weight:700;color:var(--green)">6ë‹¨ê³„ â€” ë§¤í¬ë¡œ ì²´í¬</div><div style="font-size:12px;color:var(--dim);margin-top:2px;line-height:1.5">í˜„ì¬ ê¸ˆë¦¬Â·ì‚¬ì´í´Â·ê³µí¬íƒìš•ì§€ìˆ˜ ê³ ë ¤ ì‹œ ì§€ê¸ˆì´ ë§¤ìˆ˜ ì ê¸°ì¸ê°€?</div></div></div>
          <div class="step-item"><div class="step-num" style="background:var(--orange-dim);color:var(--orange)">7</div><div><div style="font-size:12px;font-weight:700;color:var(--orange)">7ë‹¨ê³„ â€” ë°˜ë¡  ì‘ì„± (í•„ìˆ˜)</div><div style="font-size:12px;color:var(--dim);margin-top:2px;line-height:1.5">ë‚´ê°€ ì™œ í‹€ë¦´ ìˆ˜ ìˆëŠ”ê°€? ë°˜ë¡  3ê°€ì§€ë¥¼ ë¨¼ì € ì¨ë¼. ë°˜ë¡ ì´ ì¹˜ëª…ì ì´ë©´ íˆ¬ì ê¸ˆì§€.</div></div></div>
          <div class="step-item"><div class="step-num" style="background:var(--purple-dim);color:var(--purple)">8</div><div><div style="font-size:12px;font-weight:700;color:var(--purple)">8ë‹¨ê³„ â€” í¬ì§€ì…˜ ì‚¬ì´ì§•</div><div style="font-size:12px;color:var(--dim);margin-top:2px;line-height:1.5">í™•ì‹  ì •ë„ì— ë”°ë¼ ë¹„ì¤‘ ê²°ì • (3~15%). í•œ ì¢…ëª© ìµœëŒ€ 15% ì´ˆê³¼ ê¸ˆì§€.</div></div></div>
        </div>
      </div>

      <!-- ê¸ˆì§€ ì›ì¹™ -->
      <div>
        <div style="font-size:14px;font-weight:700;margin-bottom:12px">ğŸš« ì ˆëŒ€ í•˜ì§€ ë§ì•„ì•¼ í•  ê²ƒ</div>
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px">
          <div class="no-item" style="background:var(--red-dim);border:1px solid rgba(239,68,68,0.2)"><div style="font-size:12px;font-weight:700;color:var(--red);margin-bottom:4px">âŒ ì´í•´ ëª»í•œ ê¸°ì—… íˆ¬ì</div><div style="font-size:11px;color:var(--dim);line-height:1.5">ìœ íŠœë¸ŒÂ·ë¦¬ë”©ë°© ì¶”ì²œë§Œ ë³´ê³  íˆ¬ì. ê¸°ì—…ì˜ ìˆ˜ìµ êµ¬ì¡°ë¥¼ ëª¨ë¥¸ ì±„ ë§¤ìˆ˜.</div></div>
          <div class="no-item" style="background:var(--red-dim);border:1px solid rgba(239,68,68,0.2)"><div style="font-size:12px;font-weight:700;color:var(--red);margin-bottom:4px">âŒ ëª°ë¹µ</div><div style="font-size:11px;color:var(--dim);line-height:1.5">í•œ ì¢…ëª© 15% ì´ˆê³¼ ê¸ˆì§€. í™•ì‹ ì´ ê°•í•´ë„ í¬ì§€ì…˜ í•œë„ ì¤€ìˆ˜.</div></div>
          <div class="no-item" style="background:var(--red-dim);border:1px solid rgba(239,68,68,0.2)"><div style="font-size:12px;font-weight:700;color:var(--red);margin-bottom:4px">âŒ ë¬´ì§€ì„± ë¬¼íƒ€ê¸°</div><div style="font-size:11px;color:var(--dim);line-height:1.5">êµ¬ì¡°ì  ë¬¸ì œê°€ ìˆëŠ” ì¢…ëª©ì— ë¬¼íƒ€ê¸°. í•˜ë½ ì´ìœ ë¥¼ ë¨¼ì € ë¶„ì„í•  ê²ƒ.</div></div>
          <div class="no-item" style="background:var(--red-dim);border:1px solid rgba(239,68,68,0.2)"><div style="font-size:12px;font-weight:700;color:var(--red);margin-bottom:4px">âŒ ê°ì •ì  ì¦‰ê° ë§¤ë§¤</div><div style="font-size:11px;color:var(--dim);line-height:1.5">ê³µì‹œ ì§í›„ ê°ì •ì  ì¦‰ê° ë§¤ìˆ˜/ë§¤ë„. ìµœì†Œ 24ì‹œê°„ ëƒ‰ê° í›„ ê²°ì •.</div></div>
          <div class="no-item" style="background:var(--red-dim);border:1px solid rgba(239,68,68,0.2)"><div style="font-size:12px;font-weight:700;color:var(--red);margin-bottom:4px">âŒ ëª©í‘œê°€ ì—†ëŠ” ë§¤ìˆ˜</div><div style="font-size:11px;color:var(--dim);line-height:1.5">ì–¸ì œ íŒ”ì§€ ëª¨ë¥¸ ì±„ ì‚¬ëŠ” ê²ƒ. ë§¤ìˆ˜ ì „ ëª©í‘œê°€Â·ì†ì ˆê°€ ë°˜ë“œì‹œ ì„¤ì •.</div></div>
          <div class="no-item" style="background:var(--red-dim);border:1px solid rgba(239,68,68,0.2)"><div style="font-size:12px;font-weight:700;color:var(--red);margin-bottom:4px">âŒ íƒìš• êµ¬ê°„ ì‹ ê·œ ì§„ì…</div><div style="font-size:11px;color:var(--dim);line-height:1.5">VIX ë‚®ê³  ê³ ì  ê·¼ì²˜ì¼ ë•Œ ì‹ ê·œ ëŒ€ëŸ‰ ì§„ì… ê¸ˆì§€.</div></div>
          <div class="no-item" style="background:var(--red-dim);border:1px solid rgba(239,68,68,0.2)"><div style="font-size:12px;font-weight:700;color:var(--red);margin-bottom:4px">âŒ í™•ì¦ í¸í–¥ ì¡°ì‚¬</div><div style="font-size:11px;color:var(--dim);line-height:1.5">ë§¤ìˆ˜ ê²°ì • í›„ ë‚´ ì˜ê²¬ì„ ì§€ì§€í•˜ëŠ” ìë£Œë§Œ ì°¾ëŠ” ê²ƒ. ë°˜ë¡  ë¨¼ì €.</div></div>
          <div class="no-item" style="background:var(--red-dim);border:1px solid rgba(239,68,68,0.2)"><div style="font-size:12px;font-weight:700;color:var(--red);margin-bottom:4px">âŒ ë ˆë²„ë¦¬ì§€Â·ë¹šíˆ¬</div><div style="font-size:11px;color:var(--dim);line-height:1.5">ëŒ€ì¶œÂ·ì‹ ìš©ìœ¼ë¡œ ì£¼ì‹ ë§¤ìˆ˜ ì ˆëŒ€ ê¸ˆì§€. ìˆ˜ë©´ì„ ë°©í•´í•˜ëŠ” í¬ì§€ì…˜ì€ í‹€ë¦° í¬ì§€ì…˜.</div></div>
        </div>
      </div>

      <!-- ë°”ì´ì–´ìŠ¤ ì²´í¬ë¦¬ìŠ¤íŠ¸ -->
      <div>
        <div style="font-size:14px;font-weight:700;margin-bottom:6px">ğŸ§  ë§¤ìˆ˜ ì „ ë°”ì´ì–´ìŠ¤ ì²´í¬ë¦¬ìŠ¤íŠ¸</div>
        <div style="font-size:12px;color:var(--dim);margin-bottom:12px">ë§¤ìˆ˜ ë²„íŠ¼ ëˆ„ë¥´ê¸° ì „ ì•„ë˜ ì§ˆë¬¸ì— ì†”ì§í•˜ê²Œ ë‹µí•´ë³´ì„¸ìš”.</div>
        <div style="display:flex;flex-direction:column;gap:8px" id="biasBox"></div>
        <div style="margin-top:14px;padding:12px 16px;background:var(--surface2);border-radius:10px;border-left:3px solid var(--accent)">
          <div style="font-size:12px;font-weight:700;color:var(--accent);margin-bottom:4px">ì²´í¬ë¦¬ìŠ¤íŠ¸ ê²°ê³¼</div>
          <div style="font-size:12px;color:var(--dim)" id="biasResult">ì²´í¬ë°•ìŠ¤ë¥¼ ì„ íƒí•˜ë©´ ê²°ê³¼ê°€ ë‚˜ì˜µë‹ˆë‹¤.</div>
        </div>
      </div>

      <!-- ëª…ì–¸ -->
      <div class="card">
        <div style="font-size:14px;font-weight:700;margin-bottom:14px">ğŸ’¬ íˆ¬ì ê²°ì • ì „ ì½ëŠ” ëª…ì–¸</div>
        <div style="display:flex;flex-direction:column;gap:10px">
          <div class="quote-item"><div style="font-size:13px;color:var(--text);font-style:italic;line-height:1.6">"ë‚¨ë“¤ì´ íƒìš•ìŠ¤ëŸ¬ìš¸ ë•Œ ë‘ë ¤ì›Œí•˜ê³ , ë‚¨ë“¤ì´ ë‘ë ¤ì›Œí•  ë•Œ íƒìš•ìŠ¤ëŸ¬ì›Œì ¸ë¼."</div><div style="font-size:10px;color:var(--muted);margin-top:6px">â€” ì›ŒëŸ° ë²„í•</div></div>
          <div class="quote-item"><div style="font-size:13px;color:var(--text);font-style:italic;line-height:1.6">"íˆ¬ìì—ì„œ ê°€ì¥ ìœ„í—˜í•œ ë§ì€ 'ì´ë²ˆì—” ë‹¤ë¥´ë‹¤'ì´ë‹¤."</div><div style="font-size:10px;color:var(--muted);margin-top:6px">â€” ì¡´ í…œí”Œí„´</div></div>
          <div class="quote-item"><div style="font-size:13px;color:var(--text);font-style:italic;line-height:1.6">"ë¦¬ìŠ¤í¬ëŠ” ìì‹ ì´ ë¬´ì—‡ì„ í•˜ëŠ”ì§€ ëª¨ë¥¼ ë•Œ ë°œìƒí•œë‹¤."</div><div style="font-size:10px;color:var(--muted);margin-top:6px">â€” ì›ŒëŸ° ë²„í•</div></div>
          <div class="quote-item"><div style="font-size:13px;color:var(--text);font-style:italic;line-height:1.6">"ì‹œì¥ì€ ë‹¨ê¸°ì ìœ¼ë¡œ íˆ¬í‘œ ê¸°ê³„ì´ê³ , ì¥ê¸°ì ìœ¼ë¡œ ì €ìš¸ì´ë‹¤."</div><div style="font-size:10px;color:var(--muted);margin-top:6px">â€” ë²¤ì €ë¯¼ ê·¸ë ˆì´ì—„</div></div>
          <div class="quote-item"><div style="font-size:13px;color:var(--text);font-style:italic;line-height:1.6">"ì„±ê³µí•œ íˆ¬ììëŠ” ëª¨ë“  ê²°ì •ì—ì„œ ë°˜ë¡ ì„ ë¨¼ì € ì“´ë‹¤."</div><div style="font-size:10px;color:var(--muted);margin-top:6px">â€” Draft 3.0</div></div>
        </div>
      </div>
    </div>

    <!-- AI ë¶„ì„ -->
    <div class="tp" id="tab-ai">
      <div style="font-size:17px;font-weight:700;margin-bottom:4px">â¬¡ AI ì¢…ëª© ë¶„ì„ â€” Draft 3.0 ê¸°ë°˜</div>
      <div class="card">
        <div id="chat-msgs">
          <div class="msg msg-s">ANDREW AI â€” ì‹¤ì œ DART ë°ì´í„° + Draft 3.0 ì² í•™ ê¸°ë°˜ ë¶„ì„. ì¢…ëª©ëª…, ê³µì‹œ í•´ì„, ë§¤í¬ë¡œ ì§ˆë¬¸ì„ í•´ë³´ì„¸ìš”.</div>
        </div>
        <div class="ci">
          <input id="chatIn" placeholder="ì˜ˆ: ì‚¼ì„±ì „ì ì§€ê¸ˆ ë§¤ìˆ˜í•´ë„ ë¼? / HBM ìˆ˜í˜œì£¼ ì•Œë ¤ì¤˜" onkeydown="if(event.key==='Enter')sendChat()">
          <button class="btn btn-a" onclick="sendChat()">ì „ì†¡</button>
        </div>
      </div>
    </div>

  </div>
</div>

<script>
const BACKEND = "";
let dartData=[], activeFilter="ì „ì²´", chatBusy=false, krSel=null, usSel=null;

// ì‹œê°„
setInterval(()=>{
  const n=new Date();
  document.getElementById("dateStr").textContent=n.toLocaleDateString("ko-KR",{year:"numeric",month:"long",day:"numeric",weekday:"long"});
  document.getElementById("timeStr").textContent=n.toLocaleTimeString("ko-KR");
},1000);

// ë°±ì—”ë“œ ìƒíƒœ
async function checkBE(){
  try{
    await fetch(BACKEND+"/");
    document.getElementById("dot").className="dot on";
    document.getElementById("stxt").textContent="ë°±ì—”ë“œ ì—°ê²°ë¨";
  }catch{
    document.getElementById("dot").className="dot off";
    document.getElementById("stxt").textContent="ë°±ì—”ë“œ ì˜¤í”„ë¼ì¸";
  }
}
checkBE();

// íƒ­
function go(id){
  document.querySelectorAll(".tp").forEach(p=>p.classList.remove("active"));
  document.querySelectorAll(".nb").forEach(b=>b.classList.remove("active"));
  document.getElementById("tab-"+id).classList.add("active");
  document.getElementById("nav-"+id).classList.add("active");
  if(id==="dash"){fetchDart();setTimeout(()=>{drawGauge(32,"ê³µí¬");drawPort();},100);}
  if(id==="kr") renderKR();
  if(id==="us") renderUS();
  if(id==="bonds") renderBonds();
  if(id==="journal") renderJournal();
  if(id==="phil") renderBias();
}

// ê²Œì´ì§€
function drawGauge(val,label){
  const c=document.getElementById("gaugeC");if(!c)return;
  const ctx=c.getContext("2d"),cx=110,cy=95,r=72;
  ctx.clearRect(0,0,220,120);
  const g=ctx.createLinearGradient(cx-r,0,cx+r,0);
  g.addColorStop(0,"#22c55e");g.addColorStop(0.5,"#f59e0b");g.addColorStop(1,"#ef4444");
  ctx.beginPath();ctx.arc(cx,cy,r,Math.PI,0);ctx.strokeStyle="#1e2030";ctx.lineWidth=12;ctx.stroke();
  ctx.beginPath();ctx.arc(cx,cy,r,Math.PI,Math.PI+(val/100)*Math.PI);ctx.strokeStyle=g;ctx.lineWidth=12;ctx.lineCap="round";ctx.stroke();
  const ang=Math.PI+(val/100)*Math.PI,col=val<30?"#22c55e":val<50?"#f59e0b":"#ef4444";
  ctx.beginPath();ctx.moveTo(cx,cy);ctx.lineTo(cx+(r-18)*Math.cos(ang),cy+(r-18)*Math.sin(ang));ctx.strokeStyle=col;ctx.lineWidth=2.5;ctx.lineCap="round";ctx.stroke();
  ctx.fillStyle=col;ctx.font="bold 22px sans-serif";ctx.textAlign="center";ctx.fillText(val,cx,cy+20);
  ctx.fillStyle="#6b7094";ctx.font="11px sans-serif";ctx.fillText(label,cx,cy+38);
}

// í¬íŠ¸ ì°¨íŠ¸
let portChart=null;
function drawPort(){
  const c=document.getElementById("portC");if(!c)return;
  if(portChart)portChart.destroy();
  portChart=new Chart(c,{type:"doughnut",data:{labels:["êµ­ì¥ 42%","ë¯¸ì¥ 38%","í˜„ê¸ˆ 20%"],datasets:[{data:[42,38,20],backgroundColor:["#3b82f6","#22c55e","#4a4d6a"],borderWidth:0}]},options:{responsive:true,maintainAspectRatio:false,plugins:{legend:{position:"right",labels:{color:"#6b7094",font:{size:11},padding:12}}},cutout:"65%"}});
}

// DART
async function fetchDart(){
  const days=document.getElementById("daysSel").value;
  document.getElementById("dartBox").innerHTML='<div class="spin-wrap"><div class="spin"></div>ê³µì‹œ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>';
  try{
    const r=await fetch(BACKEND+"/dart/recent?days="+days);
    const j=await r.json();
    dartData=j.data||[];
    document.getElementById("lastUpd").textContent="ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸: "+new Date().toLocaleTimeString("ko-KR")+" Â· "+dartData.length+"ê±´";
    renderFilters();renderDart();
    setTimeout(()=>{drawGauge(32,"ê³µí¬");drawPort();},100);
  }catch{
    document.getElementById("dartBox").innerHTML='<div class="err"><p style="color:var(--red);font-weight:600">âš ï¸ ë°±ì—”ë“œ ì—°ê²° ì‹¤íŒ¨</p><p style="font-size:11px;color:var(--dim);margin-top:4px">ì„œë²„ í™•ì¸: '+BACKEND+'</p></div>';
  }
}

function renderFilters(){
  const cos=["ì „ì²´",...new Set(dartData.map(d=>d.company))];
  document.getElementById("cFilters").innerHTML=cos.map(c=>'<button class="filter-btn'+(c===activeFilter?" active":"")+'" onclick="setF(\''+c+'\')">'+c+'</button>').join("");
}
function setF(c){activeFilter=c;renderFilters();renderDart();}
function renderDart(){
  const fd=activeFilter==="ì „ì²´"?dartData:dartData.filter(d=>d.company===activeFilter);
  const fmt=d=>d?d.slice(0,4)+"."+d.slice(4,6)+"."+d.slice(6,8):"";
  if(!fd.length){document.getElementById("dartBox").innerHTML='<div class="card-sm" style="color:var(--muted)">ê³µì‹œ ì—†ìŒ</div>';return;}
  document.getElementById("dartBox").innerHTML='<p style="font-size:12px;color:var(--muted);margin-bottom:10px">ì´ <b style="color:var(--accent)">'+fd.length+'ê±´</b></p><div style="display:flex;flex-direction:column;gap:7px">'+fd.map(d=>'<a class="di" href="'+d.url+'" target="_blank"><span class="badge '+(d.type==="high"?"bh":d.type==="mid"?"bm":"bn")+'">'+(d.type==="high"?"ğŸ”´ ì¤‘ìš”":d.type==="mid"?"ğŸŸ¡ ì£¼ëª©":"ì¼ë°˜")+'</span><span class="badge bb">'+d.company+'</span><span style="flex:1;font-size:13px">'+d.title+'</span><span style="font-size:11px;color:var(--muted)">'+fmt(d.date)+'</span><span style="color:var(--accent);font-size:12px">â†—</span></a>').join("")+'</div>';
}

// êµ­ì¥ ë°ì´í„°
const KR=[
  {ticker:"005930",name:"ì‚¼ì„±ì „ì",sector:"ë°˜ë„ì²´",roe:18.2,pbr:1.1,evEbit:8.3,debt:32,moat:"ì›ê°€ìš°ìœ„",score:92,bb:"í•˜ë‹¨ì ‘ê·¼",discountType:"ì¼ì‹œì  ì•…ì¬",buyPct:8,successProb:78,targetPrice:82000,currentPrice:65400,phil:{quality:{pass:true,label:"í€„ë¦¬í‹° âœ“",detail:"ROE 18.2% > 15%, ë°˜ë„ì²´ ì›ê°€ìš°ìœ„ í•´ì"},discount:{pass:true,label:"ë””ìŠ¤ì¹´ìš´íŠ¸ âœ“",detail:"ì¼ì‹œì  ì•…ì¬(ì‚¬ì´í´) â€” êµ¬ì¡°ì  ë¬¸ì œ ì•„ë‹˜"},price:{pass:true,label:"ê°€ê²© âœ“",detail:"PBR 1.1x, EV/EBIT 8.3x â€” ì•ˆì „ë§ˆì§„ í™•ë³´"},macro:{pass:true,label:"ë§¤í¬ë¡œ âœ“",detail:"ê³µí¬ êµ¬ê°„(32) â€” í•˜ì›Œë“œ ë§‰ìŠ¤ ë§¤ìˆ˜ ì‹ í˜¸"},timing:{pass:true,label:"íƒ€ì´ë° âœ“",detail:"ë³¼ë¦°ì € ë°´ë“œ í•˜ë‹¨ ì ‘ê·¼"}},reason:"ìì‚¬ì£¼ ë§¤ì… + HBM4 ì–‘ì‚° ì „í™˜ ê¸°ëŒ€. ë©”ëª¨ë¦¬ ì‚¬ì´í´ ì €ì  + PBR 1.1ë¡œ ì—­ì‚¬ì  ì €í‰ê°€ êµ¬ê°„.",counter:"ì¤‘êµ­ CXMT ë¹ ë¥¸ ì¶”ê²©. ë©”ëª¨ë¦¬ ASP í•˜ë½ ì§€ì† ê°€ëŠ¥ì„±. CAPEX ë¶€ë‹´.",history:[63000,64200,62800,65100,64500,66200,65400],radar:[90,85,88,75,92]},
  {ticker:"000660",name:"SKí•˜ì´ë‹‰ìŠ¤",sector:"ë°˜ë„ì²´",roe:22.5,pbr:1.4,evEbit:6.1,debt:45,moat:"ì „í™˜ë¹„ìš©",score:88,bb:"Squeeze",discountType:"ì‚¬ì´í´ ì €ì ",buyPct:7,successProb:74,targetPrice:195000,currentPrice:165000,phil:{quality:{pass:true,label:"í€„ë¦¬í‹° âœ“",detail:"ROE 22.5%, HBM ë…ì ì  ì§€ìœ„"},discount:{pass:true,label:"ë””ìŠ¤ì¹´ìš´íŠ¸ âœ“",detail:"ë©”ëª¨ë¦¬ ì‚¬ì´í´ ì €ì , êµ¬ì¡°ì  ë¬¸ì œ ì—†ìŒ"},price:{pass:true,label:"ê°€ê²© âœ“",detail:"EV/EBIT 6.1x â€” ì—…ì¢… ìµœì €"},macro:{pass:true,label:"ë§¤í¬ë¡œ âœ“",detail:"AI ì„œë²„ ìˆ˜ìš” êµ¬ì¡°ì  ì„±ì¥"},timing:{pass:false,label:"íƒ€ì´ë° â–³",detail:"BB Squeeze â€” ë°©í–¥ì„± ë¶ˆëª…í™•"}},reason:"NVDA HBM3E ë…ì  ê³µê¸‰. HBM4 ì–‘ì‚° í™•ì •. AI ì„œë²„ ìˆ˜ìš” êµ¬ì¡°ì  ì„±ì¥.",counter:"ì‚¼ì„± HBM ì¶”ê²©. ë¶€ì±„ë¹„ìœ¨ 45% ì£¼ì˜.",history:[158000,162000,160000,167000,163000,168000,165000],radar:[88,82,90,70,75]},
  {ticker:"006400",name:"ì‚¼ì„±SDI",sector:"ë°°í„°ë¦¬",roe:14.1,pbr:0.9,evEbit:7.8,debt:38,moat:"ì „í™˜ë¹„ìš©",score:85,bb:"í•˜ë‹¨ì ‘ê·¼",discountType:"ì„¹í„° ì„¼í‹°ë¨¼íŠ¸",buyPct:5,successProb:68,targetPrice:380000,currentPrice:285000,phil:{quality:{pass:false,label:"í€„ë¦¬í‹° â–³",detail:"ROE 14.1% â€” 15% ê¸°ì¤€ ê·¼ì ‘ ë¯¸ë‹¬"},discount:{pass:true,label:"ë””ìŠ¤ì¹´ìš´íŠ¸ âœ“",detail:"EV ì„¼í‹°ë¨¼íŠ¸ ì•…í™” â€” ì¼ì‹œì "},price:{pass:true,label:"ê°€ê²© âœ“",detail:"PBR 0.9x â€” ìˆœìì‚° ì´í•˜"},macro:{pass:false,label:"ë§¤í¬ë¡œ â–³",detail:"EV ì„±ì¥ ë‘”í™” ìš°ë ¤ ì§€ì†"},timing:{pass:true,label:"íƒ€ì´ë° âœ“",detail:"ë³¼ë¦°ì € ë°´ë“œ í•˜ë‹¨ ì ‘ê·¼"}},reason:"PBR 0.9x ì—­ì‚¬ì  ì €ì . ì „ê³ ì²´ ë°°í„°ë¦¬ 2027 ì–‘ì‚°. BMW, ìŠ¤í…”ë€í‹°ìŠ¤ ìˆ˜ì£¼.",counter:"EV ìˆ˜ìš” íšŒë³µ ì‹œê¸° ë¶ˆí™•ì‹¤. ì¤‘êµ­ CATL ê°€ê²© ê²½ìŸ.",history:[295000,288000,278000,282000,275000,290000,285000],radar:[75,88,70,65,82]},
  {ticker:"035420",name:"NAVER",sector:"í”Œë«í¼",roe:12.8,pbr:1.6,evEbit:14.2,debt:28,moat:"ë„¤íŠ¸ì›Œí¬",score:74,bb:"ì¤‘ë¦½",discountType:"ì„±ì¥ ë‘”í™”",buyPct:3,successProb:55,targetPrice:220000,currentPrice:185000,phil:{quality:{pass:false,label:"í€„ë¦¬í‹° â–³",detail:"ROE 12.8% â€” ê¸°ì¤€ ë¯¸ë‹¬"},discount:{pass:false,label:"ë””ìŠ¤ì¹´ìš´íŠ¸ â–³",detail:"ì„±ì¥ ë‘”í™” êµ¬ì¡°ì ì¸ì§€ ë¶ˆëª…í™•"},price:{pass:false,label:"ê°€ê²© â–³",detail:"EV/EBIT 14.2x â€” í”„ë¦¬ë¯¸ì—„ ê³¼ë‹¤"},macro:{pass:true,label:"ë§¤í¬ë¡œ âœ“",detail:"AI ê²€ìƒ‰ ì „í™˜ ê¸°íšŒ"},timing:{pass:false,label:"íƒ€ì´ë° â–³",detail:"BB ì¤‘ë¦½"}},reason:"ë¼ì¸ì•¼í›„ ì§€ë¶„ ì¬í¸. HyperCLOVA AI ì»¤ë¨¸ìŠ¤ ì ìš©.",counter:"êµ¬ê¸€ AI ê²€ìƒ‰ ì ì‹. ROE ì§€ì† í•˜ë½ ì¶”ì„¸.",history:[192000,188000,183000,187000,181000,189000,185000],radar:[60,55,58,70,55]},
  {ticker:"051910",name:"LGí™”í•™",sector:"í™”í•™",roe:8.3,pbr:0.7,evEbit:11.5,debt:65,moat:"ì›ê°€ìš°ìœ„",score:45,bb:"í•˜ë‹¨ì´íƒˆ",discountType:"êµ¬ì¡°ì  ë¬¸ì œ",buyPct:0,successProb:35,targetPrice:350000,currentPrice:265000,phil:{quality:{pass:false,label:"í€„ë¦¬í‹° âœ—",detail:"ROE 8.3% â€” ê¸°ì¤€ í¬ê²Œ ë¯¸ë‹¬"},discount:{pass:false,label:"ë””ìŠ¤ì¹´ìš´íŠ¸ âœ—",detail:"êµ¬ì¡°ì  ë¬¸ì œ â€” íˆ¬ì ì œì™¸"},price:{pass:true,label:"ê°€ê²© âœ“",detail:"PBR 0.7x ì €í‰ê°€ì§€ë§Œ ê°€ì¹˜í•¨ì • ìœ„í—˜"},macro:{pass:false,label:"ë§¤í¬ë¡œ âœ—",detail:"ì„ìœ í™”í•™ ì—…í™© ì¥ê¸° ì¹¨ì²´"},timing:{pass:false,label:"íƒ€ì´ë° âœ—",detail:"BB í•˜ë‹¨ ì´íƒˆ"}},reason:"PBR 0.7x ì—­ì‚¬ì  ì €ì .",counter:"ë¶€ì±„ë¹„ìœ¨ 65%. êµ¬ì¡°ì  ì—…í™© ì•…í™”. Draft 3.0 ê¸°ì¤€ íˆ¬ì ì œì™¸.",history:[285000,278000,271000,268000,260000,263000,265000],radar:[40,35,55,30,35]},
  {ticker:"207940",name:"ì‚¼ì„±ë°”ì´ì˜¤",sector:"ë°”ì´ì˜¤",roe:16.8,pbr:5.2,evEbit:42.1,debt:22,moat:"ì „í™˜ë¹„ìš©",score:70,bb:"ì¤‘ë¦½",discountType:"ê³ í‰ê°€",buyPct:0,successProb:48,targetPrice:980000,currentPrice:870000,phil:{quality:{pass:true,label:"í€„ë¦¬í‹° âœ“",detail:"ROE 16.8%, CDMO ì‹œì¥ ë…ì "},discount:{pass:false,label:"ë””ìŠ¤ì¹´ìš´íŠ¸ âœ—",detail:"ê³ í‰ê°€ â€” ì•ˆì „ë§ˆì§„ ì—†ìŒ"},price:{pass:false,label:"ê°€ê²© âœ—",detail:"PBR 5.2x, EV/EBIT 42x"},macro:{pass:true,label:"ë§¤í¬ë¡œ âœ“",detail:"ê¸€ë¡œë²Œ ë°”ì´ì˜¤ ì•„ì›ƒì†Œì‹± ìˆ˜ìš” ì¦ê°€"},timing:{pass:false,label:"íƒ€ì´ë° â–³",detail:"BB ì¤‘ë¦½"}},reason:"ê¸€ë¡œë²Œ 5ìœ„ CDMO. 5ê³µì¥ ì¦ì„¤. ìˆ˜ì£¼ ì”ê³  ì—­ëŒ€ ìµœê³ .",counter:"PBR 5.2x â€” ì•ˆì „ë§ˆì§„ ì—†ìŒ. í•˜ë½ ê¸°ë‹¤ë¦´ ê²ƒ.",history:[850000,862000,875000,858000,880000,865000,870000],radar:[75,30,25,72,55]},
];

function scoreColor(s){return s>=80?"var(--green)":s>=60?"var(--orange)":"var(--red)";}
function probColor(p){return p>=70?"var(--green)":p>=55?"var(--orange)":"var(--red)";}
function scoreBar(s){const c=scoreColor(s);return '<div class="sb-wrap"><div class="sb-track"><div class="sb-fill" style="width:'+s+'%;background:'+c+'"></div></div><span class="sb-num" style="color:'+c+'">'+s+'</span></div>';}

function stockCardHTML(s,i,sel,isUS){
  const mc=Object.values(s.phil).filter(p=>p.pass).length;
  const sc=scoreColor(s.score),pc=probColor(s.successProb);
  const metric1=isUS?{label:"ROIC",val:s.roic+"%",good:s.roic>=30}:{label:"ROE",val:s.roe+"%",good:s.roe>=15};
  const metric2=isUS?{label:"PEG",val:s.peg+"x",good:s.peg<=1.5}:{label:"PBR",val:s.pbr+"x",good:s.pbr<=1.2};
  return '<div class="stock-card'+(sel===i?" sel":"")+'" onclick="'+(isUS?"selectUS":"selectKR")+'('+i+')">'+
    '<div style="display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:12px">'+
    '<div><div style="font-size:15px;font-weight:700">'+s.name+'</div><div style="font-size:10px;color:var(--muted);margin-top:2px">'+s.ticker+' Â· '+s.sector+'</div></div>'+
    '<span class="badge ba" style="font-size:13px;padding:4px 10px">'+s.score+'</span></div>'+
    '<div style="margin-bottom:12px"><div style="display:flex;justify-content:space-between;margin-bottom:4px"><span style="font-size:11px;color:var(--muted)">Draft 3.0 ë§¤ì¹­</span><span style="font-size:11px;font-weight:700;color:'+sc+'">'+mc+'/5</span></div>'+
    '<div class="match-bar"><div class="match-fill" style="width:'+(mc/5*100)+'%"></div></div>'+
    '<div style="display:flex;gap:4px;margin-top:6px">'+Object.values(s.phil).map(p=>'<span style="width:28px;height:4px;border-radius:2px;background:'+(p.pass?"var(--green)":"var(--red)")+';display:inline-block"></span>').join("")+'</div></div>'+
    '<div style="display:grid;grid-template-columns:1fr 1fr;gap:6px;margin-bottom:12px">'+
    '<div style="background:var(--surface2);border-radius:6px;padding:7px"><div style="font-size:9px;color:var(--muted)">'+metric1.label+'</div><div style="font-size:13px;font-weight:700;color:'+(metric1.good?"var(--green)":"var(--orange)")+'">'+metric1.val+'</div></div>'+
    '<div style="background:var(--surface2);border-radius:6px;padding:7px"><div style="font-size:9px;color:var(--muted)">'+metric2.label+'</div><div style="font-size:13px;font-weight:700;color:'+(metric2.good?"var(--green)":"var(--text)")+'">'+metric2.val+'</div></div>'+
    '<div style="background:var(--surface2);border-radius:6px;padding:7px"><div style="font-size:9px;color:var(--muted)">ë§¤ìˆ˜ ë¹„ì¤‘</div><div style="font-size:13px;font-weight:700;color:'+(s.buyPct>0?"var(--accent)":"var(--muted)")+'">'+( s.buyPct>0?s.buyPct+"% ê¶Œì¥":"ì œì™¸")+'</div></div>'+
    '<div style="background:var(--surface2);border-radius:6px;padding:7px"><div style="font-size:9px;color:var(--muted)">ì„±ê³µí™•ë¥ </div><div style="font-size:13px;font-weight:700;color:'+pc+'">'+s.successProb+'%</div></div></div>'+
    '<div><div style="display:flex;justify-content:space-between;margin-bottom:4px"><span style="font-size:10px;color:var(--muted)">ëª©í‘œê°€ ë„ë‹¬ í™•ë¥  (12M)</span><span style="font-size:10px;font-weight:700;color:'+pc+'">'+s.successProb+'%</span></div>'+
    '<div class="prob-bar"><div class="prob-fill" style="width:'+s.successProb+'%;background:'+pc+'"></div></div></div>'+
    '<div style="margin-top:10px;font-size:10px;color:var(--accent);text-align:center">í´ë¦­í•˜ì—¬ ìƒì„¸ ë¶„ì„ ë³´ê¸° â†“</div></div>';
}

function renderKR(){document.getElementById("krCards").innerHTML=KR.map((s,i)=>stockCardHTML(s,i,krSel,false)).join("");}
function renderUS(){document.getElementById("usCards").innerHTML=US.map((s,i)=>stockCardHTML(s,i,usSel,true)).join("");}

let rChart=null,pChart=null;
function detailHTML(s,isUS){
  const sc=scoreColor(s.score),pc=probColor(s.successProb);
  const upside=Math.round((s.targetPrice/s.currentPrice-1)*100);
  const pricePrefix=isUS?"$":"â‚©";
  return '<div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:18px">'+
    '<div><div style="font-size:18px;font-weight:700">'+s.name+' <span style="font-size:13px;color:var(--muted);font-weight:400">'+s.ticker+'</span></div>'+
    '<div style="font-size:12px;color:var(--muted);margin-top:2px">'+s.sector+' Â· ëª©í‘œê°€ '+pricePrefix+s.targetPrice.toLocaleString()+'</div></div>'+
    '<div style="text-align:right"><div style="font-size:28px;font-weight:800;color:'+sc+'">'+s.score+'</div><div style="font-size:10px;color:var(--muted)">ì¢…í•© ì ìˆ˜</div></div></div>'+
    '<div class="g2" style="margin-bottom:16px"><div><div style="font-size:11px;color:var(--muted);margin-bottom:8px">ìµœê·¼ 7ì¼ ì£¼ê°€</div><canvas id="pC" height="160"></canvas></div>'+
    '<div><div style="font-size:11px;color:var(--muted);margin-bottom:8px">Draft 3.0 ë ˆì´ë”</div><canvas id="rC" height="160"></canvas></div></div>'+
    '<div class="g2" style="margin-bottom:16px">'+
    '<div class="card-sm"><div class="ct">ê¶Œì¥ ë§¤ìˆ˜ ë¹„ì¤‘</div><div style="font-size:32px;font-weight:800;color:'+(s.buyPct>0?"var(--accent)":"var(--muted)")+'">'+( s.buyPct>0?s.buyPct+"%":"ì œì™¸")+'</div><div style="font-size:11px;color:var(--dim);margin-top:4px">'+(s.buyPct>0?"í¬íŠ¸í´ë¦¬ì˜¤ ëŒ€ë¹„ ë¶„í• ë§¤ìˆ˜":"Draft 3.0 ê¸°ì¤€ ë¯¸ì¶©ì¡±")+'</div></div>'+
    '<div class="card-sm"><div class="ct">ì„±ê³µí™•ë¥  (12M)</div><div style="font-size:32px;font-weight:800;color:'+pc+'">'+s.successProb+'%</div><div style="font-size:11px;color:var(--dim);margin-top:4px">'+pricePrefix+s.currentPrice.toLocaleString()+' â†’ '+pricePrefix+s.targetPrice.toLocaleString()+' (+'+upside+'%)</div>'+
    '<div class="prob-bar" style="margin-top:8px;height:8px"><div class="prob-fill" style="width:'+s.successProb+'%;background:'+pc+'"></div></div></div></div>'+
    '<div style="margin-bottom:16px"><div style="font-size:12px;font-weight:600;margin-bottom:8px">Draft 3.0 ì²´í¬ë¦¬ìŠ¤íŠ¸</div><div style="display:flex;flex-direction:column;gap:6px">'+
    Object.values(s.phil).map(p=>'<div class="check-item '+(p.pass?"ci-pass":"ci-fail")+'"><span style="font-size:16px">'+(p.pass?"âœ“":"âœ—")+'</span><div><div style="font-size:12px;font-weight:600;color:'+(p.pass?"var(--green)":"var(--red)")+'">'+p.label+'</div><div style="font-size:11px;color:var(--dim)">'+p.detail+'</div></div></div>').join("")+'</div></div>'+
    '<div class="g2"><div style="padding:14px;background:var(--green-dim);border-radius:10px;border-left:3px solid var(--green)">'+
    '<div style="font-size:10px;font-weight:700;color:var(--green);margin-bottom:6px">ğŸ“ˆ íˆ¬ì ë…¼ë¦¬</div><div style="font-size:12px;line-height:1.7">'+s.reason+'</div></div>'+
    '<div style="padding:14px;background:var(--red-dim);border-radius:10px;border-left:3px solid var(--red)">'+
    '<div style="font-size:10px;font-weight:700;color:var(--red);margin-bottom:6px">âš ï¸ ë°˜ë¡ </div><div style="font-size:12px;line-height:1.7">'+s.counter+'</div></div></div>';
}

function showDetail(s,panelId,contentId,isUS){
  const panel=document.getElementById(panelId);
  panel.style.display="block";
  document.getElementById(contentId).innerHTML=detailHTML(s,isUS);
  setTimeout(()=>{
    if(pChart)pChart.destroy();
    pChart=new Chart(document.getElementById("pC"),{type:"line",data:{labels:["7ì¼ì „","6ì¼ì „","5ì¼ì „","4ì¼ì „","3ì¼ì „","2ì¼ì „","ì˜¤ëŠ˜"],datasets:[{data:s.history,fill:true,borderColor:isUS?"#22c55e":"#c9a55a",backgroundColor:isUS?"rgba(34,197,94,0.1)":"rgba(201,165,90,0.1)",tension:0.4,pointRadius:3,borderWidth:2}]},options:{responsive:true,maintainAspectRatio:false,plugins:{legend:{display:false}},scales:{x:{grid:{color:"#1e2030"},ticks:{color:"#4a4d6a",font:{size:9}}},y:{grid:{color:"#1e2030"},ticks:{color:"#4a4d6a",font:{size:9},callback:v=>v.toLocaleString()}}}}});
    if(rChart)rChart.destroy();
    rChart=new Chart(document.getElementById("rC"),{type:"radar",data:{labels:["í€„ë¦¬í‹°","ë””ìŠ¤ì¹´ìš´íŠ¸","ê°€ê²©","ë§¤í¬ë¡œ","íƒ€ì´ë°"],datasets:[{data:s.radar,fill:true,borderColor:isUS?"#22c55e":"#c9a55a",backgroundColor:isUS?"rgba(34,197,94,0.15)":"rgba(201,165,90,0.15)",borderWidth:2}]},options:{responsive:true,maintainAspectRatio:false,plugins:{legend:{display:false}},scales:{r:{min:0,max:100,grid:{color:"#1e2030"},ticks:{display:false},pointLabels:{color:"#6b7094",font:{size:10}}}}}});
  },50);
  panel.scrollIntoView({behavior:"smooth",block:"start"});
}

function selectKR(i){
  if(krSel===i){krSel=null;document.getElementById("kr-detail").style.display="none";renderKR();return;}
  krSel=i;renderKR();showDetail(KR[i],"kr-detail","kr-detail-content",false);
}
function selectUS(i){
  if(usSel===i){usSel=null;document.getElementById("us-detail").style.display="none";renderUS();return;}
  usSel=i;renderUS();showDetail(US[i],"us-detail","us-detail-content",true);
}

// ë¯¸ì¥ ë°ì´í„°
const US=[
  {ticker:"MSFT",name:"Microsoft",sector:"í´ë¼ìš°ë“œ/AI",roic:42.3,peg:1.8,moat:"ì „í™˜ë¹„ìš©+ë„¤íŠ¸ì›Œí¬",score:94,phase:"ë³´ìœ  ìœ ì§€",buyPct:10,successProb:82,targetPrice:480,currentPrice:415,reason:"Azure 30%+ ì„±ì¥. Copilot AI ì „ ì œí’ˆ íƒ‘ì¬. Office 365 ì „í™˜ë¹„ìš© í•´ì.",counter:"Valuation ë¶€ë‹´(PE 35x). OpenAI ì˜ì¡´ ë¦¬ìŠ¤í¬.",history:[408,412,409,418,414,420,415],radar:[95,80,78,90,85],phil:{quality:{pass:true,label:"í€„ë¦¬í‹° âœ“",detail:"ROIC 42.3%, ì „í™˜ë¹„ìš©+ë„¤íŠ¸ì›Œí¬ í•´ì"},discount:{pass:true,label:"ë””ìŠ¤ì¹´ìš´íŠ¸ âœ“",detail:"AI ì „í™˜ ê³¼ì†Œí‰ê°€"},price:{pass:true,label:"ê°€ê²© âœ“",detail:"PEG 1.8x â€” í•©ë¦¬ì "},macro:{pass:true,label:"ë§¤í¬ë¡œ âœ“",detail:"AI ì¸í”„ë¼ ì¥ê¸° ì„±ì¥"},timing:{pass:true,label:"íƒ€ì´ë° âœ“",detail:"ì¡°ì • í›„ ë§¤ìˆ˜ ê¸°íšŒ"}}},
  {ticker:"AAPL",name:"Apple",sector:"ì†Œë¹„ì ê¸°ìˆ ",roic:58.2,peg:2.1,moat:"ë¸Œëœë“œ+ìƒíƒœê³„",score:90,phase:"ë³´ìœ  ìœ ì§€",buyPct:8,successProb:76,targetPrice:250,currentPrice:218,reason:"ì„œë¹„ìŠ¤ ë§¤ì¶œ 30%+ ì„±ì¥. Apple Intelligence AI íƒ‘ì¬.",counter:"ì¤‘êµ­ ë§¤ì¶œ ì˜ì¡´ë„ 30%. PEG 2.1 ë‹¤ì†Œ ë¶€ë‹´.",history:[212,215,210,220,216,222,218],radar:[92,72,70,85,80],phil:{quality:{pass:true,label:"í€„ë¦¬í‹° âœ“",detail:"ROIC 58.2% â€” ì„¸ê³„ ìµœê³ "},discount:{pass:true,label:"ë””ìŠ¤ì¹´ìš´íŠ¸ âœ“",detail:"ì¤‘êµ­ ë¦¬ìŠ¤í¬ ê³¼ëŒ€ ë°˜ì˜"},price:{pass:false,label:"ê°€ê²© â–³",detail:"PEG 2.1x â€” ì•½ê°„ ê³ í‰ê°€"},macro:{pass:true,label:"ë§¤í¬ë¡œ âœ“",detail:"AI ì˜¨ë””ë°”ì´ìŠ¤ ì„ ë„"},timing:{pass:true,label:"íƒ€ì´ë° âœ“",detail:"ì¡°ì • êµ¬ê°„"}}},
  {ticker:"GOOGL",name:"Alphabet",sector:"ê´‘ê³ /AI/í´ë¼ìš°ë“œ",roic:32.5,peg:1.2,moat:"ë„¤íŠ¸ì›Œí¬+ë°ì´í„°",score:91,phase:"ì§„ì… ê°€ëŠ¥",buyPct:9,successProb:80,targetPrice:230,currentPrice:193,reason:"PEG 1.2x â€” ë¹…í…Œí¬ ì¤‘ ê°€ì¥ ì €í‰ê°€. Google Cloud 28% ì„±ì¥.",counter:"AI ê²€ìƒ‰ ìê¸°ì ì‹. DOJ ë°˜ë…ì  ì†Œì†¡.",history:[185,189,183,195,191,196,193],radar:[88,85,92,82,80],phil:{quality:{pass:true,label:"í€„ë¦¬í‹° âœ“",detail:"ROIC 32.5%, ê²€ìƒ‰ ë…ì "},discount:{pass:true,label:"ë””ìŠ¤ì¹´ìš´íŠ¸ âœ“",detail:"AI ìê¸°ì ì‹ ìš°ë ¤ ê³¼ëŒ€"},price:{pass:true,label:"ê°€ê²© âœ“",detail:"PEG 1.2x â€” ë¹…í…Œí¬ ìµœì €"},macro:{pass:true,label:"ë§¤í¬ë¡œ âœ“",detail:"í´ë¼ìš°ë“œ+AI ì „í™˜ ìˆ˜í˜œ"},timing:{pass:true,label:"íƒ€ì´ë° âœ“",detail:"52ì£¼ ì €ì  ê·¼ì²˜"}}},
  {ticker:"V",name:"Visa",sector:"ê¸ˆìœµ ë„¤íŠ¸ì›Œí¬",roic:44.8,peg:1.5,moat:"ë„¤íŠ¸ì›Œí¬íš¨ê³¼",score:89,phase:"ë³´ìœ  ìœ ì§€",buyPct:7,successProb:75,targetPrice:320,currentPrice:285,reason:"ê¸€ë¡œë²Œ ê²°ì œ ë„¤íŠ¸ì›Œí¬ ë…ì . ROIC 44.8%. ì¸í”Œë ˆì´ì…˜ ìë™ í—¤ì§€.",counter:"í•€í…Œí¬ ê²½ìŸ(Stripe, Block). ìˆ˜ìˆ˜ë£Œ ê·œì œ ë¦¬ìŠ¤í¬.",history:[278,282,279,288,283,290,285],radar:[90,75,80,85,78],phil:{quality:{pass:true,label:"í€„ë¦¬í‹° âœ“",detail:"ROIC 44.8%, ê²°ì œ ë…ì "},discount:{pass:true,label:"ë””ìŠ¤ì¹´ìš´íŠ¸ âœ“",detail:"í•€í…Œí¬ ìœ„í˜‘ ê³¼ëŒ€"},price:{pass:true,label:"ê°€ê²© âœ“",detail:"PEG 1.5x"},macro:{pass:true,label:"ë§¤í¬ë¡œ âœ“",detail:"ë””ì§€í„¸ ê²°ì œ ì„±ì¥"},timing:{pass:false,label:"íƒ€ì´ë° â–³",detail:"BB ì¤‘ë¦½"}}},
  {ticker:"COST",name:"Costco",sector:"ìœ í†µ",roic:28.1,peg:2.8,moat:"ì›ê°€ìš°ìœ„+ë¸Œëœë“œ",score:78,phase:"ê³ í‰ê°€ ì£¼ì˜",buyPct:0,successProb:45,targetPrice:900,currentPrice:975,reason:"ë©¤ë²„ì‹­ í•´ì. ê²½ê¸° ë°©ì–´ì .",counter:"PEG 2.8x â€” ê³¼ëŒ€í‰ê°€. ëª©í‘œê°€ í˜„ì¬ê°€ í•˜íšŒ.",history:[955,962,970,958,980,968,975],radar:[80,40,35,75,45],phil:{quality:{pass:true,label:"í€„ë¦¬í‹° âœ“",detail:"ROIC 28.1%"},discount:{pass:false,label:"ë””ìŠ¤ì¹´ìš´íŠ¸ âœ—",detail:"ê³ í‰ê°€"},price:{pass:false,label:"ê°€ê²© âœ—",detail:"PEG 2.8x"},macro:{pass:true,label:"ë§¤í¬ë¡œ âœ“",detail:"ê²½ê¸° ë°©ì–´ì "},timing:{pass:false,label:"íƒ€ì´ë° âœ—",detail:"52ì£¼ ê³ ì "}}},
];

// ì±„ê¶Œ
function renderBonds(){
  const bonds=[{name:"ë¯¸êµ­ 10Y êµ­ì±„",yield:"4.52%",change:"+0.03",up:true,signal:"ê¸ˆë¦¬ ìƒìŠ¹ â€” ì‹ ê·œ ì£¼ì‹ ì§„ì… ì‹ ì¤‘"},{name:"í•œêµ­ 3Y êµ­ì±„",yield:"3.28%",change:"-0.02",up:false,signal:"ì•ˆì •ì "},{name:"ë¯¸êµ­ 2Y-10Y ìŠ¤í”„ë ˆë“œ",yield:"0.15%",change:"+0.05",up:true,signal:"ì •ìƒí™” ì§„í–‰ ì¤‘"}];
  const comm=[{name:"ê¸ˆ",price:"$2,645",change:"+1.2%",up:true,signal:"ì•ˆì „ìì‚° ìˆ˜ìš” ìƒìŠ¹"},{name:"WTI ì›ìœ ",price:"$71.3",change:"-0.8%",up:false,signal:"ê³µê¸‰ ê³¼ì‰ ì£¼ì˜"},{name:"êµ¬ë¦¬",price:"$9,120",change:"+0.5%",up:true,signal:"ê²½ê¸° íšŒë³µ ì‹ í˜¸"}];
  document.getElementById("bondsBox").innerHTML='<div style="display:flex;flex-direction:column;gap:8px;margin-bottom:16px">'+bonds.map(b=>'<div class="card-sm" style="display:flex;justify-content:space-between;align-items:center"><div><div style="font-size:13px;font-weight:600">'+b.name+'</div><div style="font-size:11px;color:var(--muted);margin-top:2px">'+b.signal+'</div></div><div style="text-align:right"><div style="font-size:20px;font-weight:700">'+b.yield+'</div><div style="font-size:12px;color:'+(b.up?"var(--red)":"var(--green)")+'">'+b.change+'</div></div></div>').join("")+'</div><div class="g3">'+comm.map(c=>'<div class="card"><div class="ct">'+c.name+'</div><div style="font-size:22px;font-weight:700">'+c.price+'</div><div style="font-size:13px;font-weight:600;color:'+(c.up?"var(--green)":"var(--red)")+'">'+c.change+'</div><div style="font-size:11px;color:var(--dim);margin-top:6px">'+c.signal+'</div></div>').join("")+'</div>';
}

// íˆ¬ì ì¼ì§€
const JOURNAL=[
  {date:"2026-02-25",ticker:"005930",name:"ì‚¼ì„±ì „ì",action:"ë§¤ìˆ˜",reason:"ìì‚¬ì£¼ ë§¤ì… ê³µì‹œ + ROE 18% + PBR 1.1. BB í•˜ë‹¨ ì ‘ê·¼. Draft 3.0 5/5 í†µê³¼.",counter:"ë©”ëª¨ë¦¬ ì‚¬ì´í´ í”¼í¬ì•„ì›ƒ. ì¤‘êµ­ CXMT ì¶”ê²©.",target:"â‚©82,000",buyPct:8,successProb:78},
  {date:"2026-02-20",ticker:"MSFT",name:"Microsoft",action:"ë³´ìœ ìœ ì§€",reason:"ROIC 42%, Azure AI ì„±ì¥. PEG 1.8. Draft 3.0 5/5.",counter:"Valuation ë¶€ë‹´. OpenAI ì˜ì¡´ë„.",target:"$480",buyPct:10,successProb:82},
];
function renderJournal(){
  document.getElementById("journalBox").innerHTML=JOURNAL.map(j=>'<div class="journal-card card" style="margin-bottom:14px"><div style="display:flex;align-items:center;gap:10px;margin-bottom:14px"><span class="badge '+(j.action==="ë§¤ìˆ˜"?"bg":"bb")+'">'+j.action+'</span><span style="font-size:15px;font-weight:700">'+j.name+'</span><span style="font-size:11px;color:var(--muted)">'+j.ticker+'</span><span style="font-size:11px;color:var(--muted);margin-left:auto">'+j.date+'</span></div><div class="g2" style="margin-bottom:12px"><div class="card-sm"><div style="font-size:9px;color:var(--muted);margin-bottom:4px">ê¶Œì¥ ë¹„ì¤‘</div><div style="font-size:22px;font-weight:800;color:var(--accent)">'+j.buyPct+'%</div></div><div class="card-sm"><div style="font-size:9px;color:var(--muted);margin-bottom:4px">ì„±ê³µí™•ë¥ </div><div style="font-size:22px;font-weight:800;color:'+(j.successProb>=70?"var(--green)":"var(--orange)")+'">'+j.successProb+'%</div></div></div><div class="g2" style="margin-bottom:12px"><div style="padding:12px;background:var(--green-dim);border-radius:8px;border-left:3px solid var(--green)"><div style="font-size:10px;font-weight:700;color:var(--green);margin-bottom:5px">íˆ¬ì ë…¼ë¦¬</div><div style="font-size:12px;line-height:1.6">'+j.reason+'</div></div><div style="padding:12px;background:var(--red-dim);border-radius:8px;border-left:3px solid var(--red)"><div style="font-size:10px;font-weight:700;color:var(--red);margin-bottom:5px">ë°˜ë¡ </div><div style="font-size:12px;line-height:1.6">'+j.counter+'</div></div></div><div style="font-size:12px"><span style="color:var(--muted)">ëª©í‘œê°€: </span><span style="color:var(--accent);font-weight:700">'+j.target+'</span></div></div>').join("");
}

// ë°”ì´ì–´ìŠ¤ ì²´í¬ë¦¬ìŠ¤íŠ¸
const BIASES=[
  {id:"b1",bias:"í™•ì¦ í¸í–¥",q:"ë§¤ìˆ˜ ì „ ë°˜ë¡  3ê°€ì§€ë¥¼ ë¨¼ì € ì‘ì„±í–ˆëŠ”ê°€?",warn:"NOë©´ ë§¤ìˆ˜ ê¸ˆì§€ â€” ë°˜ë¡ ë¶€í„° ì¨ë¼"},
  {id:"b2",bias:"ê³¼ì‹  í¸í–¥",q:"ë‚´ê°€ ê¸°ê´€íˆ¬ììë³´ë‹¤ ë” ë§ì€ ì •ë³´ë¥¼ ê°–ê³  ìˆë‹¤ê³  ìƒê°í•˜ëŠ”ê°€?",warn:"YESë©´ ê²½ê³„ â€” ê²¸ì†í•´ì§ˆ ê²ƒ"},
  {id:"b3",bias:"ì†ì‹¤ íšŒí”¼",q:"ì†ì‹¤ ì¤‘ì¸ ì¢…ëª©ì„ 'ì–¸ì  ê°€ ì˜¤ë¥´ê² ì§€'ë¡œ ë³´ìœ  ì¤‘ì¸ê°€?",warn:"YESë©´ íˆ¬ì ë…¼ë¦¬ ì¬ê²€í†  í•„ìš”"},
  {id:"b4",bias:"ì•µì»¤ë§",q:"ë§¤ìˆ˜ê°€ì— ì§‘ì°©í•´ í˜„ì¬ í€ë”ë©˜íƒˆì„ ë¬´ì‹œí•˜ê³  ìˆì§€ ì•Šì€ê°€?",warn:"YESë©´ ë§¤ìˆ˜ê°€ ìŠê³  í˜„ì¬ê°€ì¹˜ ì¬í‰ê°€"},
  {id:"b5",bias:"êµ°ì¤‘ ì‹¬ë¦¬",q:"ì´ ì¢…ëª©ì„ SNSÂ·ë¦¬ë”©ë°©ì´ ì¶”ì²œí•´ì„œ ê´€ì‹¬ ê°–ê²Œ ëëŠ”ê°€?",warn:"YESë©´ ë…ë¦½ì  ë¶„ì„ ë¨¼ì €"},
  {id:"b6",bias:"ìµœì‹  í¸í–¥",q:"ìµœê·¼ ì£¼ê°€ ìƒìŠ¹ë§Œ ë³´ê³  ë¯¸ë˜ë„ ì˜¤ë¥¼ ê²ƒì´ë¼ ê°€ì •í•˜ëŠ”ê°€?",warn:"YESë©´ ë°¸ë¥˜ì—ì´ì…˜ ì¬í™•ì¸"},
  {id:"b7",bias:"ì²˜ë¶„ íš¨ê³¼",q:"ìˆ˜ìµ ì¤‘ì¸ ì¢‹ì€ ì£¼ì‹ì„ ë„ˆë¬´ ë¹¨ë¦¬ íŒ”ê³  ì‹¶ì€ ì¶©ë™ì´ ìˆëŠ”ê°€?",warn:"YESë©´ ëª©í‘œê°€ê¹Œì§€ ë³´ìœ  ê³„íš ì¬ê²€í† "},
  {id:"b8",bias:"ë³µì¡ì„± íšŒí”¼",q:"ì´ ê¸°ì—…ì˜ ì‚¬ì—…ë³´ê³ ì„œë¥¼ ì§ì ‘ ì½ì–´ë´¤ëŠ”ê°€?",warn:"NOë©´ ë§¤ìˆ˜ ê¸ˆì§€ â€” ì§ì ‘ ì½ì„ ê²ƒ"},
];
function renderBias(){
  document.getElementById("biasBox").innerHTML=BIASES.map(b=>'<div class="bias-item"><input type="checkbox" id="'+b.id+'" onchange="updateBias()" style="margin-top:2px;accent-color:var(--accent);width:16px;height:16px;cursor:pointer;flex-shrink:0"><div style="flex:1"><div style="display:flex;align-items:center;gap:8px;margin-bottom:3px"><span class="badge bp" style="font-size:9px">'+b.bias+'</span><span style="font-size:12px;font-weight:600">'+b.q+'</span></div><div style="font-size:10px;color:var(--orange)">âš ï¸ '+b.warn+'</div></div></div>').join("");
}
function updateBias(){
  const checked=BIASES.filter(b=>document.getElementById(b.id)&&document.getElementById(b.id).checked).length;
  const pct=Math.round(checked/BIASES.length*100);
  const col=pct>=75?"var(--green)":pct>=50?"var(--orange)":"var(--red)";
  const msg=pct>=75?"âœ… ë°”ì´ì–´ìŠ¤ ì¸ì‹ ì–‘í˜¸ â€” ë§¤ìˆ˜ ê²€í†  ê°€ëŠ¥":pct>=50?"âš ï¸ ì¼ë¶€ ë¯¸í™•ì¸ â€” ì‹ ì¤‘í•˜ê²Œ":pct>=25?"ğŸ”´ ì²´í¬ ë¶€ì¡± â€” ë§¤ìˆ˜ ë³´ë¥˜":"ğŸš« ë¯¸í™•ì¸ â€” ë§¤ìˆ˜ ê¸ˆì§€";
  document.getElementById("biasResult").innerHTML='<span style="color:'+col+';font-weight:700">'+msg+'</span><br><span style="font-size:11px;color:var(--dim)">'+checked+'/'+BIASES.length+'ê°œ í™•ì¸ ì™„ë£Œ</span>';
}

// AI
async function sendChat(){
  if(chatBusy)return;
  const inp=document.getElementById("chatIn");
  const msg=inp.value.trim();if(!msg)return;
  inp.value="";addMsg(msg,"u");chatBusy=true;
  const loading=addMsg("ë¶„ì„ ì¤‘...","a");
  let dartCtx="";
  try{const r=await fetch(BACKEND+"/dart/recent?days=7");const j=await r.json();dartCtx=(j.data||[]).slice(0,5).map(d=>d.company+": "+d.title+" ("+d.date+")").join("\n");}catch{}
  const sys="ë‹¹ì‹ ì€ Andrewì˜ íˆ¬ì ë¶„ì„ AIì…ë‹ˆë‹¤. Draft 3.0 ì² í•™(ë²„í•+í•˜ì›Œë“œ ë§‰ìŠ¤+ì¹´ë„ˆë¨¼) ê¸°ë°˜.\n\nì˜¤ëŠ˜ DART ê³µì‹œ:\n"+(dartCtx||"ì—†ìŒ")+"\n\nêµ­ì¥: ì‚¼ì„±ì „ì(92ì ,8%,78%), SKí•˜ì´ë‹‰ìŠ¤(88ì ,7%,74%), ì‚¼ì„±SDI(85ì ,5%,68%)\në¯¸ì¥: MSFT(94ì ,10%,82%), GOOGL(91ì ,9%,80%), AAPL(90ì ,8%,76%)\n\në‹µë³€í˜•ì‹: â– ìš”ì•½ â– Draft3.0ì²´í¬ â– íˆ¬ìë…¼ë¦¬ â– ë°˜ë¡  â– ê²°ë¡ . í•œêµ­ì–´ ê°„ê²°í•˜ê²Œ.";
  try{
    const r=await fetch("https://api.anthropic.com/v1/messages",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({model:"claude-sonnet-4-20250514",max_tokens:1000,system:sys,messages:[{role:"user",content:msg}]})});
    const d=await r.json();
    loading.textContent=d.content&&d.content[0]?d.content[0].text:"ì‘ë‹µ ì˜¤ë¥˜";
  }catch{loading.textContent="AI ì‘ë‹µ ì˜¤ë¥˜ â€” ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.";}
  chatBusy=false;
}
function addMsg(text,role){
  const d=document.createElement("div");d.className="msg msg-"+role;d.textContent=text;
  const c=document.getElementById("chat-msgs");c.appendChild(d);c.scrollTop=c.scrollHeight;return d;
}

// ì´ˆê¸°í™”
fetchDart();
</script>
</body>
</html>